{"version":3,"sources":["0_pixi_mod.js","1_options.js","1_utility.js","2_main.js","a_mixin_event.js","a_mixin_util.js","cache.js","class_0_ui.js","class_battler.js","class_keyboard.js","class_sprite.js","class_ui_scene.js","class_window.js","scene_home.js","scene_map.js","tilemap.js"],"names":["PIXI","DisplayObject","prototype","enabled","enable","this","visible","disable","update","delta","zIndex","Container","children","sort","a","b","child","Object","defineProperty","[object Object]","obj","Filament","Scene","parent","scene","addChild","Texture","crop","x","y","w","h","rect","arguments","length","Rectangle","baseTexture","Sprite","texture","Enum","values","value","SCALE_MODE","settings","width","height","tileSize","cellSize","scaleMode","HYBRID","maintainAspectRatio","uiRes","language","configure","options","assign","loadSettings","async","fetch","gameFile","json","body","document","style","setProperty","defineProperties","pixiScaleMode","get","NORMAL","SCALE_MODES","LINEAR","NEAREST","truncateNumber","n","truncs","Math","floor","LARGE_NUMBER_ABBREVIATIONS","sleep","ms","Promise","resolve","setTimeout","minmax","min","max","val","round","places","func","factor","pow","ceil","arrayAdd","array","index","indexOf","splice","arrayRemove","mixin_object","target","mixin","implement","call","Function","_mixins","push","bind","instance","clazz","untag","s","v","Array","string","i","html","args","div","createElement","innerHTML","NodeList","childNodes","node","append","Element","match","element","id","reg","exec","classList","add","setAttribute","mount","mountElement","handler","construct","isConstructor","f","Boolean","Proxy","err","CoordMap","dimensions","dfault","defaultArgs","data","yz","_getValue","_getSubDimension","set","subdimension","unset","keys","has","pixiCanvas","querySelector","parentElement","ui_container","getElementById","pixi","Application","view","backgroundColor","start","pixiContext","getContext","hybridCanvas","hybridContext","appendChild","opacity","window","addEventListener","resize","ticker","scenes","elapsedMS","updateUI","render","drawImage","roundScale","scaleX","offsetWidth","scaleY","offsetHeight","scale","ratio1","renderer","imageSmoothingEnabled","MixinEvents","events","eventname","create","event","eventlist","getEventList","callback","remove","removeEvent","MixinUtil","key","Cache","_cache","path","gameAsset","resource","requestJSON","image","requestImage","TileSet","requestAsset","url","reject","AssetLoader","addRequest","cache","loaders","Loader","super","_requests","load","loader","resources","request","error","AssetRequest","UI","ui","anchor","ObservablePoint","_onAnchorUpdate","setAccessor","position","v1","v2","destroy","parentNode","removeChild","name","String","getAttribute","getPropertyValue","attributes","properties","worldVisible","mountUI","Battler","stats","lethality","resilience","haste","spirit","luck","keyboard","getKey","code","keygroup","keygroups","fireEvent","keyname","keyEventHandler","Key","addEventHandler","keydownHandler","keyupHandler","isDown","KeyGroup","keynames","addKey","EMPTY","loadTexture","activeScene","home","oldScene","enter","leave","stage","windows","Window","ui_width","ui_height","minwidth","minheight","maxwidth","maxheight","_hasFrame","_interactive","movable","resizable","closable","edgeSnap","content","handle","closeButton","teletype","dragging","finishDrag","contentObserver","MutationObserver","resizing","observe","attributeFilter","interactive","hasFrame","bounds","left","worldTransform","tx","top","ty","getBoundsUI","windex","setProperties","--width","--height","--x","--y","--z","--alpha","worldAlpha","setAttributes","data-frame","data-interactive","data-movable","data-resizable","data-closable","movementX","movementY","text","win","updateDrag","updateResize","alpha","map","TileMap","MapCellTexture","RenderTexture","tilemap","BaseRenderTexture","MapCellLayer","tileset","stamp","getStamp","MapCell","baseLayer","fringeLayer","loaded","lastTileset","actors","stack","tile","loadTile","tileData","tilesetId","ts","tileX","tileY","requestTileset","tileId","getTile","layer","drawTile","row","undefined","note","passage","opaque","terrain","actorLayer","cells","selector","TileSelector"],"mappings":"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","file":"engine.js","sourcesContent":["PIXI.DisplayObject.prototype.enabled=true;\nPIXI.DisplayObject.prototype.enable=function(){\n\tthis.enabled=true;\n\tthis.visible=true;\n};\nPIXI.DisplayObject.prototype.disable=function(){\n\tthis.enabled=false;\n\tthis.visible=false;\n};\nPIXI.DisplayObject.prototype.update=function(delta){};\n\nPIXI.DisplayObject.prototype.zIndex=0;\nPIXI.Container.prototype.update=function(delta){\n\tthis.children.sort((a,b)=>a.zIndex-b.zIndex);\n\tfor(const child of this.children){\n\t\tchild.update(delta);\n\t}\n};\n\nObject.defineProperty(PIXI.DisplayObject.prototype,'scene',{\n\tget(){\n\t\tlet obj=this;\n\t\twhile (!(obj instanceof Filament.Scene) && obj.parent){\n\t\t\tobj=obj.parent;\n\t\t}\n\t\treturn (obj instanceof Filament.Scene)?obj:null;\n\t},\n\tset(scene){\n\t\tif(this.scene===scene){ return; }\n\t\tscene.addChild(this);\n\t}\n});\n\nPIXI.Texture.prototype.crop=function(x,y,w,h){\n\tconst rect = arguments.length===1?x:new PIXI.Rectangle(x,y,w,h);\n\treturn new PIXI.Texture(this.baseTexture,rect);\n}\n\nPIXI.Sprite.prototype.crop=function(){\n\tthis.texture = this.texture.crop(...arguments);\n}","Filament.Enum = class Enum{\n\tconstructor(...values){\n\t\tfor (const value of values){\n\t\t\tthis[value]=value;\n\t\t}\n\t}\n};\n\nFilament.SCALE_MODE = new Filament.Enum(\n\t\"NORMAL\",\"NEAREST\",\"HYBRID\"\n);\n\nFilament.settings = {\n\twidth: 320,\n\theight: 240,\n\ttileSize: 16,\n\tcellSize: 24,\n\tscaleMode: Filament.SCALE_MODE.HYBRID,\n\tmaintainAspectRatio: true,\n\tuiRes:1,\n\tlanguage:'en',\n};\n\nFilament.configure=options=>{\n\tObject.assign(Filament.settings,options);\n};\n\nFilament.loadSettings=async function(){\n\tconst settings = await (await fetch(Filament.gameFile('settings.json'))).json();\n\tFilament.configure(settings);\n\n\tconst body = document.body.style;\n\tbody.setProperty('--uiRes',Filament.settings.uiRes);\n\tbody.setProperty('--screen-width',Filament.settings.width);\n\tbody.setProperty('--screen-height',Filament.settings.height);\n\tbody.setProperty('--tileSize',Filament.settings.tileSize);\n};\n\nObject.defineProperties(Filament,{\n\tpixiScaleMode:{\n\t\tget:()=>Filament.settings.scaleMode===Filament.SCALE_MODE.NORMAL ? PIXI.SCALE_MODES.LINEAR : PIXI.SCALE_MODES.NEAREST\n\t}\n});","Filament.truncateNumber=n=>{\n\tif(n<=99999){ return n+''; }\n\tlet truncs = 0;\n\twhile (n>9999 && truncs<5){\n\t\tn/=1000;\n\t\t++truncs;\n\t}\n\treturn Math.floor(n)+Filament.LARGE_NUMBER_ABBREVIATIONS[truncs];\n};\nFilament.LARGE_NUMBER_ABBREVIATIONS=[\n\t'','K','M','B','T','Q'\n];\nFilament.sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));\n\nFilament.minmax=(min,max,val)=>Math.max(min,Math.min(max,val));\n\nFilament.round=(value,places=0,func='round')=>{\n\tconst factor = Math.pow(10,places);\n\treturn Math[func](value*factor)/factor\n}\nFilament.floor=(value,places)=>Filament.round(value,places,'floor');\nFilament.ceil=(value,places)=>Filament.round(value,places,'ceil');\n\nFilament.arrayAdd=(array,obj,index=array.length)=>{\n\tif(array.indexOf(obj)>=0){ return true; }\n\tarray.splice(index,0,obj);\n\treturn false;\n}\n\nFilament.arrayRemove=(array,obj)=>{\n\tconst index=array.indexOf(obj);\n\tif(index>=0){\n\t\tarray.splice(index,1);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nFilament.mixin_object=(target,mixin)=>{\n\tObject.assign(target,mixin);\n\tif(typeof mixin.implement === 'function'){ mixin.implement.call(target); }\n}\n\nFilament.mixin=(target,mixin)=>{\n\tif (!(target instanceof Function)){ return Filament.mixin_object(target,mixin); }\n\tif(!target._mixins){ target._mixins=[] }\n\ttarget._mixins.push(mixin);\n\tObject.assign(target.prototype,mixin);\n\ttarget.prototype.implement=Filament.implement.bind(this);\n}\nFilament.implement=function(instance,clazz){\n\tif (!instance || !clazz._mixins){ return; }\n\tfor (const mixin of clazz._mixins){\n\t\tif(typeof mixin.implement === 'function'){ mixin.implement.call(instance); }\n\t}\n}\n\nFilament.untag=(s,...v)=>{\n\tif(!(s instanceof Array)){ return s; }\n\tlet string = '';\n\tfor (const i in s){ string+=s[i]+(v[i]||''); }\n\treturn string;\n}\n\nFilament.html=(...args)=>{\n\tconst string = Filament.untag(...args);\n\tconst div = document.createElement('div');\n\tdiv.innerHTML=string;\n\treturn new Filament.NodeList(...div.childNodes);\n}\n\nFilament.NodeList=class extends Array{\n\tmount(target){\n\t\tfor (const node of this){\n\t\t\ttarget.append(node);\n\t\t}\n\t\treturn this;\n\t}\n\telements(){\n\t\tlet array = [];\n\t\tfor (const node of this){\n\t\t\tif(node instanceof Element){ array.push(node); }\n\t\t}\n\t\treturn array;\n\t}\n}\n\nFilament.createElement=(string,child)=>{\n\tlet match = string.match(/^[^\\s.#[\\]]+/);\n\tif(!match){throw `Couldn't find tagname in string ${string}`;}\n\tconst element = document.createElement(match[0]);\n\tmatch=string.match(/#([^\\s.#[\\]]+)/);\n\tif(match){ element.id=match[1]; }\n\tlet reg=/\\.([^\\s.#[\\]]+)/g;\n\twhile(match=reg.exec(string)){\n\t\telement.classList.add(match[1]);\n\t}\n\treg=/\\[([^\\s.#[\\]=]+)=([^\\s.#[\\]=]+)\\]/g;\n\twhile(match=reg.exec(string)){\n\t\telement.setAttribute(match[1],match[2]);\n\t}\n\tif(child){ element.append(child); }\n\telement.mount=Filament.mountElement;\n\treturn element;\n}\n\nFilament.mountElement=function(target){\n\tif(!(this instanceof Element)){ return; }\n\ttarget.append(this);\n\treturn this;\n};\n\n{\n\tconst handler = {construct(){return handler;}};\n\tFilament.isConstructor=f=>{\n\t\ttry{\n\t\t\treturn Boolean(new (new Proxy(f,handler)));\n\t\t}catch(err){\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\nFilament.CoordMap = class{\n\tconstructor(dimensions=2,dfault=null,...defaultArgs){\n\t\tthis.dimensions=dimensions;\n\t\tthis.dfault=dfault;\n\t\tthis.defaultArgs=defaultArgs;\n\t\tthis.data={};\n\t}\n\tget(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn this._getValue(x);\n\t\t}\n\t\treturn this._getSubDimension(x).get(...yz);\n\t}\n\t_getValue(x){\n\t\tif(x in this.data){\n\t\t\treturn this.data[x];\n\t\t}\n\t\tif(typeof this.dfault==='function'){\n\t\t\tif(Filament.isConstructor(this.dfault)){\n\t\t\t\treturn new this.dfault(...this.defaultArgs);\n\t\t\t}else{\n\t\t\t\treturn this.dfault(...this.defaultArgs);\n\t\t\t}\n\t\t}else{\n\t\t\treturn this.dfault;\n\t\t}\n\t}\n\t_getSubDimension(x){\n\t\tif( !(this.data[x] instanceof Filament.CoordMap) ){\n\t\t\tthis.data[x]=new Filament.CoordMap(this.dimensions-1,this.dfault,...this.defaultArgs);\n\t\t}\n\t\treturn this.data[x];\n\t}\n\tset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tthis.data[x]=yz[0];\n\t\t\treturn;\n\t\t}\n\t\tthis._getSubDimension(x).set(...yz);\n\t}\n\tunset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tdelete this.data[x];\n\t\t\treturn;\n\t\t}\n\t\tconst subdimension = this._getSubDimension(x);\n\t\tsubdimension.unset(...yz);\n\t\tif(Object.keys(subdimension.data).length===0){\n\t\t\tdelete this.data[x];\n\t\t}\n\t}\n\thas(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn x in this.data;\n\t\t}\n\t\tif( !(x in this.data) ){ return false;}\n\t\treturn this._getSubDimension(x).has(...yz);\n\t}\n}\n","Filament.pixiCanvas = document.querySelector(\"#screen-game canvas\");\nFilament.parent = Filament.pixiCanvas.parentElement;\nFilament.ui_container = document.getElementById(\"ui-container\");\nFilament.pixi = new PIXI.Application({\n\tview: Filament.pixiCanvas,\n\twidth: Filament.settings.width,\n\theight: Filament.settings.height,\n\tbackgroundColor:0x000088\n});\n\nFilament.start=async function(){\n\tawait Filament.loadSettings();\n\tFilament.pixiContext = Filament.pixiCanvas.getContext(\"2d\");\n\tif( Filament.settings.scaleMode === Filament.SCALE_MODE.HYBRID ){\n\t\tFilament.hybridCanvas = document.createElement('canvas');\n\t\tFilament.hybridContext = Filament.hybridCanvas.getContext(\"2d\");\n\t\tFilament.hybridCanvas.id=\"hybrid-canvas\";\n\t\tFilament.pixiCanvas.parentElement.appendChild(Filament.hybridCanvas);\n\t\tFilament.pixiCanvas.style.opacity=0;\n\t}\n\n\tFilament.ui_container.style.width = Filament.settings.width*Filament.settings.uiRes+\"px\";\n\tFilament.ui_container.style.height = Filament.settings.height*Filament.settings.uiRes+\"px\";\n\n\twindow.addEventListener('resize',Filament.resize);\n\tFilament.resize();\n\tFilament.ticker = Filament.pixi.ticker.add(Filament.update,Filament);\n\n\tfor (const scene of Object.values(Filament.scenes)){\n\t\tscene.start();\n\t}\n};\n\nFilament.update=()=>{\n\tconst delta = Filament.ticker.elapsedMS/1000;\n\n\tif(Filament.scene){\n\t\tFilament.scene.update(delta);\n\t\tFilament.scene.updateUI(delta);\n\t}\n\n\tif(Filament.hybridCanvas){\n\t\tFilament.pixi.render();\n\t\tFilament.hybridContext.drawImage(\n\t\t\tFilament.pixiCanvas,\n\t\t\t0,0, Filament.settings.width, Filament.settings.height,\n\t\t\t0,0, Filament.hybridCanvas.width, Filament.hybridCanvas.height\n\t\t);\n\t}\n};\n\nFilament.roundScale=n=>Math.round(n)||1;\n\nFilament.resize=()=>{\n\tlet scaleX = Filament.parent.offsetWidth / Filament.settings.width;\n\tlet scaleY = Filament.parent.offsetHeight / Filament.settings.height;\n\tlet scale = Math.min(scaleX,scaleY);\n\tif(Filament.settings.maintainAspectRatio){\n\t\tscaleX = scaleY = scale;\n\t}else{\n\t\tlet ratio1 = Filament.parent.offsetWidth/Filament.parent.offsetHeight;\n\t\tlet ratio2 = Filament.settings.width/Filament.settings.height;\n\t\tif(ratio1>ratio2){//wide\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.height*ratio1,\n\t\t\t\tFilament.settings.height\n\t\t\t);\n\t\t}else{ //tall\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.width,\n\t\t\t\tFilament.settings.width/ratio1\n\t\t\t);\n\t\t}\n\t\t\n\t}\n\tFilament.scaleX=scaleX;\n\tFilament.scaleY=scaleY;\n\tFilament.scale=scale;\n\t\n\tFilament.pixiCanvas.style.width = Filament.settings.width*scaleX+\"px\";\n\tFilament.pixiCanvas.style.height = Filament.settings.height*scaleY+\"px\";\n\tif(Filament.hybridCanvas){\n\t\tFilament.hybridCanvas.width = Filament.settings.width*Filament.roundScale(scaleX);\n\t\tFilament.hybridCanvas.height = Filament.settings.height*Filament.roundScale(scaleY);\n\t\tFilament.hybridCanvas.style.width = Filament.pixiCanvas.style.width;\n\t\tFilament.hybridCanvas.style.height = Filament.pixiCanvas.style.height;\n\t\tFilament.hybridContext.imageSmoothingEnabled=false;\n\t}\n\tFilament.ui_container.style.setProperty('--scale',\n\t\tscale/Filament.settings.uiRes);\n\tFilament.ui_container.style.setProperty('--left',\n\t\tFilament.parent.offsetWidth/2 - Filament.ui_container.offsetWidth/2);\n\tFilament.ui_container.style.setProperty('--top',\n\t\tFilament.parent.offsetHeight/2 - Filament.ui_container.offsetHeight/2);\n};","Filament.MixinEvents={\n\timplement(){\n\t\tthis.events={};\n\t},\n\tgetEventList(eventname,create){\n\t\tif(!(eventname in this.events) && create){\n\t\t\tthis.events[eventname]=[];\n\t\t}\n\t\treturn this.events[eventname];\n\t},\n\tfireEvent(eventname,event={}){\n\t\tconst eventlist=this.getEventList(eventname,false);\n\t\tif(!eventlist){ return; }\n\t\tfor (const callback of eventlist){\n\t\t\tevent.remove=Filament.MixinEvents.removeEvent.bind(this,eventname,callback);\n\t\t\tif(typeof callback === 'function'){ callback(event); }\n\t\t}\n\t\t\n\t},\n\taddEvent(eventname,callback){\n\t\treturn Filament.arrayAdd(this.getEventList(eventname,true),callback);\n\t},\n\tremoveEvent(eventname,callback){\n\t\tconst eventlist = this.getEventList(eventname,false);\n\t\tif(!eventlist){ return false; }\n\t\treturn Filament.arrayRemove(this.events[eventname],callback);\n\t}\n}","Filament.MixinUtil={\r\n\tmount(parent){\r\n\t\tparent.addChild(this);\r\n\t\treturn this;\r\n    },\r\n    assign(key,value){\r\n        if(typeof arguments[0]===\"object\"){\r\n            Object.assign(this,arguments[0]);\r\n        }else{\r\n            this[key]=value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\nFilament.mixin(PIXI.DisplayObject, Filament.MixinUtil);","Filament.Cache=class{\n\tconstructor(){\n\t\tthis._cache={};\n\t}\n\n\tasync requestImage(key,path='assets/images'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\tresource.texture.baseTexture.scaleMode=Filament.pixiScaleMode;\n\t\t\treturn resource.texture;\n\t\t});\n\t}\n\tasync requestAudio(key){\n\t\t\n\t}\n\tasync requestJSON(key,path='data'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\treturn resource.data;\n\t\t})\n\t}\n\tasync requestTileset(id){\n\t\tconst data = await requestJSON(`tilesets/${id}.json`);\n\t\tconst image = await requestImage(data.image,'assets/tilesets');\n\t\treturn new Filament.TileSet(image,data);\n\t}\n\tasync gameAsset(key,path,callback){\n\t\tpath=Filament.path(path,key);\n\t\treturn await this.requestAsset(path,Filament.gameFile(path),callback);\n\t}\n\trequestAsset(key,url,callback){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tif(!this._cache[key]){\n\t\t\t\tthis._cache[key]=new Filament.AssetLoader(key,url,this);\n\t\t\t}\n\t\t\tif(this._cache[key] instanceof Filament.AssetLoader){\n\t\t\t\tthis._cache[key].addRequest(resolve,reject,callback);\n\t\t\t}else{\n\t\t\t\tresolve(callback(this._cache[key]));\n\t\t\t}\n\t\t});\n\t}\n}\nFilament.cache=new Filament.Cache();\n\nFilament.AssetLoader=class extends PIXI.loaders.Loader{\n\tconstructor(key,url,cache){\n\t\tsuper();\n\t\tthis.add(key,url);\n\t\tthis._requests=[];\n\t\tthis.load((loader,resources)=>{\n\t\t\tconst resource=resources[key];\n\t\t\tfor (const request of this._requests){\n\t\t\t\tif(resource.error){\n\t\t\t\t\trequest.reject(resource.error);\n\t\t\t\t}else{\n\t\t\t\t\trequest.resolve(request.callback(resource));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(resource.error){\n\t\t\t\tdelete cache._cache[key];\n\t\t\t}else{\n\t\t\t\tcache._cache[key]=resource;\n\t\t\t}\n\t\t});\n\t}\n\taddRequest(resolve,reject,callback){\n\t\tthis._requests.push(new Filament.AssetRequest(resolve,reject,callback));\n\t}\n}\n\nFilament.AssetRequest=class{\n\tconstructor(resolve,reject,callback){\n\t\tthis.resolve=resolve;\n\t\tthis.reject=reject;\n\t\tthis.callback=callback;\n\t}\n}","Filament.UI = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.ui = document.createElement('div');\n\t\tthis.anchor = new PIXI.ObservablePoint(this._onAnchorUpdate, this);\n\t\tthis.setAccessor('id');\n\t\tthis.setAccessor('className');\n\t\tthis.classList=this.ui.classList;\n\t\tthis.style=this.ui.style;\n\t\tthis.style.position=\"absolute\";\n\t}\n\tmount(parent){\n\t\tparent.addChild(this);\n\t\treturn this;\n\t}\n\tmountUI(parent){\n\t\t(parent instanceof Filament.UI ? parent.ui : parent).append(this.ui);\n\t\treturn this;\n\t}\n\tsetAccessor(v1,v2=v1){\n\t\tObject.defineProperty(this,v1,{\n\t\t\tget(){return this.ui[v2];},\n\t\t\tset(v){this.ui[v2]=v;}\n\t\t});\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-enabled',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-enabled',false);\n\t}\n\tdestroy(){\n\t\tsuper.destroy();\n\t\tthis.ui.parentNode.removeChild(this.ui);\n\t}\n\tsetAttribute(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.getAttribute(name)!==value){\n\t\t\tthis.ui.setAttribute(name,value);\n\t\t}\n\t}\n\tsetProperty(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.style.getPropertyValue(name)!==value){\n\t\t\tthis.ui.style.setProperty(name,value);\n\t\t}\n\t}\n\tsetAttributes(attributes){\n\t\tfor (const key in attributes){ this.setAttribute(key,attributes[key]); }\n\t}\n\tsetProperties(properties){\n\t\tfor (const key in properties){ this.setProperty(key,properties[key]); }\n\t}\n\tupdateUI(delta){\n\t\tthis.setAttribute(\"data-visible\",this.worldVisible);\n\t\tif(!this.ui.parentNode && this.scene && this.scene!==this){ this.mountUI(this.scene); }\n\t}\n\t_onAnchorUpdate(){\n\t\t//this.ui.style.transform = \"translate(\"+-this.anchor.x*100+\"%,\"+-this.anchor.y*100+\"%)\";\n\t}\n}","/* NOTES\nLethality (attack power)\nResilience (hp and def)\nHaste (SP)\nSpirit (MP)\n\nhidden stats:\nLuck\n\n\nEquipment types:\nWeapon\nArmor\nAccessory\n*/\n\nFilament.Battler = class{\n\tconstructor(){\n\t\tthis.stats={\n\t\t\tlethality:0,\n\t\t\tresilience:0,\n\t\t\thaste:0,\n\t\t\tspirit:0,\n\t\t\tluck:0,\n\t\t};\n\t}\n};","Filament.keyboard={\n\tkeys:{},\n\tkeyEventHandler(eventname,event){\n\t\tconst key = this.getKey(event.code,false);\n\t\tif(!key){ return; }\n\t\tif(typeof key[eventname] === 'function')key[eventname]();\n\t\tfor (const keygroup of key.keygroups){\n\t\t\tkeygroup.fireEvent(eventname,event);\n\t\t}\n\t},\n\taddEventHandler(keyname){\n\t\tthis[`${keyname}Handler`]=this.keyEventHandler.bind(this,keyname);\n\t},\n\tgetKey(keyname,create){\n\t\tif(!(keyname in this.keys) && create){\n\t\t\tthis.keys[keyname]=new Filament.Key(keyname);\n\t\t}\n\t\treturn this.keys[keyname];\n\t}\n};\nFilament.keyboard.addEventHandler('keydown');\nFilament.keyboard.addEventHandler('keyup');\n\nFilament.parent.addEventListener('keydown',Filament.keyboard.keydownHandler);\nFilament.parent.addEventListener('keyup',Filament.keyboard.keyupHandler);\n\nFilament.Key = class{\n\tconstructor(name){\n\t\tthis.name=name;\n\t\tthis.isDown=false;\n\t\tthis.keygroups=[];\n\t}\n\tkeydown(){\n\t\tthis.isDown=true;\n\t}\n\tkeyup(){\n\t\tthis.isDown=false;\n\t}\n}\n\nFilament.keys={};\nFilament.KeyGroup = class{\n\tconstructor(name,keynames=[]){\n\t\tthis.name=name;\n\t\tFilament.keys[name]=this;\n\t\tthis.keys=[];\n\t\tfor (const keyname of keynames){\n\t\t\tthis.addKey(keyname);\n\t\t}\n\t\t//Filament.mixin(this,Filament.EventMixin);\n\t\tthis.implement(this,Filament.KeyGroup);\n\t}\n\taddKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,true);\n\t\tFilament.arrayAdd(key.keygroups,this);\n\t\tFilament.arrayAdd(this.keys,key);\n\t}\n\tremoveKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,false);\n\t\tif(!key){ return; }\n\t\tFilament.arrayRemove(key.keygroups,this);\n\t\tFilament.arrayRemove(this.keys,key);\n\t}\n\tget isDown(){\n\t\tfor (const key in this.keys){\n\t\t\tif(key.isDown){ return true; }\n\t\t}\n\t\treturn false;\n\t}\n}\nFilament.mixin(Filament.KeyGroup, Filament.MixinEvents);\n\nnew Filament.KeyGroup('CONFIRM',['Enter','Space']);\nnew Filament.KeyGroup('CANCEL',['Escape']);\nnew Filament.KeyGroup('UP',['ArrowUp','KeyW']);\nnew Filament.KeyGroup('LEFT',['ArrowLeft','KeyA']);\nnew Filament.KeyGroup('DOWN',['ArrowDown','KeyS']);\nnew Filament.KeyGroup('RIGHT',['ArrowRight','KeyD']);","Filament.Sprite = class extends PIXI.Sprite{\n\tconstructor(key){\n\t\tsuper(PIXI.Texture.EMPTY);\n\t\tthis.loadTexture(key);\n\t}\n\tasync loadTexture(key){\n\t\tthis.texture=await Filament.cache.requestImage(key);\n\t}\n}","Filament.scenes={};\nFilament.activeScene=\"home\";\nObject.defineProperty(Filament,\"scene\",{\n\tget:()=>Filament.scenes[Filament.activeScene]||Filament.scenes.home,\n\tset(value){\n\t\tconst oldScene=Filament.activeScene;\n\t\tif(value in Filament.scenes){\n\t\t\tFilament.activeScene=value;\n\t\t}else{\n\t\t\tfor (const key in Filament.scenes){\n\t\t\t\tif(value===Filament.scenes[key]){\n\t\t\t\t\tFilament.activeScene=key;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(Filament.activeScene===oldScene){ return; }\n\t\tfor (const key in Filament.scenes){\n\t\t\tconst scene = Filament.scenes[key];\n\t\t\tif(Filament.activeScene===scene.name){\n\t\t\t\tscene.enable();\n\t\t\t\tscene.enter();\n\t\t\t}else if (scene.enabled){\n\t\t\t\tscene.disable();\n\t\t\t\tscene.leave();\n\t\t\t}\n\t\t}\n\t}\n})\n\nFilament.ui_container = document.getElementById(\"ui-container\");\n\nFilament.Scene = class extends Filament.UI{\n\tconstructor(name){\n\t\tsuper();\n\t\tthis.mountUI(Filament.ui_container);\n\t\tthis.mount(Filament.pixi.stage);\n\t\tFilament.scenes[name] = this;\n\t\tthis.id=\"scene-\"+name;\n\t\tthis.classList.add(\"scene\");\n\t\tthis.name=name;\n\t\tthis.windows=[];\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-visible',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tfor (let i=this.windows.length-1; i>=0; --i){\n\t\t\tthis.windows[i].updateUI(delta);\n\t\t}\n\t}\n\tstart(){}\n\tenter(){}\n\tleave(){}\n}","Filament.Window = class extends Filament.UI{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('window');\n\t\tthis.ui_width=20;\n\t\tthis.ui_height=20;\n\t\tthis.minwidth=20;\n\t\tthis.minheight=20;\n\t\tthis.maxwidth=Filament.settings.width;\n\t\tthis.maxheight=Filament.settings.height;\n\t\tthis._hasFrame=false;\n\t\tthis._interactive=false;\n\t\tthis.movable=false;\n\t\tthis.resizable=false;\n\t\tthis.closable=false;\n\t\tthis.edgeSnap=true;\n\t\tthis.content=Filament.createElement('div.content').mount(this.ui);\n\t\tthis.handle=Filament.createElement('div.handle').mount(this.ui);\n\t\tthis.closeButton=Filament.createElement('div.closeButton','Ã—').mount(this.ui);\n\t\tthis.closeButton.addEventListener('click',event=>{\n\t\t\tthis.destroy();\n\t\t});\n\t\tthis.teletype=0;\n\t\tthis.handle.addEventListener('mousedown',event=>{\n\t\t\tFilament.arrayRemove(this.scene.windows,this);\n\t\t\tFilament.arrayAdd(this.scene.windows,this);\n\t\t\tthis.dragging=true;\n\t\t});\n\t\tthis.handle.addEventListener('mouseup',event=>{\n\t\t\tthis.dragging=false;\n\t\t\tthis.finishDrag(event);\n\t\t});\n\t\tthis.contentObserver=new MutationObserver(()=>{\n\t\t\tif(this.resizable){\n\t\t\t\tif(this.content.style.width||this.content.style.height){\n\t\t\t\t\tthis.content.style.width='';\n\t\t\t\t\tthis.content.style.height='';\n\t\t\t\t\tthis.resizing=true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.contentObserver.observe(this.content,{attributes:true,attributeFilter:['style']});\n\t}\n\tmount(parent){\n\t\tsuper.mount(parent);\n\t\tif(parent.scene)this.mountUI(this.scene);\n\t\treturn this;\n\t}\n\tmountUI(scene){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.mountUI(scene);\n\t\tFilament.arrayAdd(scene.windows,this);\n\t\treturn this;\n\t}\n\tdestroy(){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.destroy(...arguments);\n\t}\n\tget width(){return this.ui_width;}\n\tset width(v){this.ui_width=v;}\n\tget height(){return this.ui_height;}\n\tset height(v){this.ui_height=v;}\n\tget interactive(){return this._interactive||this.movable||this.resizable||this.closable;}\n\tset interactive(v){this._interactive=v;}\n\tget hasFrame(){return this._hasFrame||this.movable||this.resizable||this.closable;}\n\tset hasFrame(v){this._hasFrame=v;}\n\tgetBoundsUI(){\n\t\tlet bounds = {};\n\t\tbounds.width = Filament.round(this.width,2);\n\t\tbounds.height = Filament.round(this.height,2);\n\t\tbounds.left=Filament.round(this.worldTransform.tx-this.anchor.x*bounds.width,2);\n\t\tbounds.top=Filament.round(this.worldTransform.ty-this.anchor.y*bounds.height,2);\n\t\tif(this.edgeSnap){\n\t\t\tbounds.left=Filament.minmax(0,Filament.settings.width-bounds.width,bounds.left);\n\t\t\tbounds.top=Filament.minmax(0,Filament.settings.height-bounds.height,bounds.top);\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tif(this.resizable){\n\t\t\tthis.width=Filament.minmax(this.minwidth,this.maxwidth,this.width);\n\t\t\tthis.height=Filament.minmax(this.minheight,this.maxheight,this.height);\n\t\t}\n\t\tlet bounds = this.getBoundsUI(true);\n\t\tconst windex = this.scene.windows.indexOf(this);\n\t\tthis.setProperties({\n\t\t\t\"--width\"\t:\tbounds.width,\n\t\t\t\"--height\"\t:\tbounds.height,\n\t\t\t\"--x\"\t\t:\tbounds.left,\n\t\t\t\"--y\"\t\t:\tbounds.top,\n\t\t\t\"--z\"\t\t:\tthis.zIndex+windex/1000,\n\t\t\t\"--alpha\"\t:\tthis.worldAlpha,\n\t\t});\n\t\tthis.setAttributes({\n\t\t\t\"data-frame\"\t\t:\tthis.hasFrame,\n\t\t\t\"data-interactive\"\t:\tthis.interactive,\n\t\t\t\"data-movable\"\t\t:\tthis.movable,\n\t\t\t\"data-resizable\"\t:\tthis.resizable,\n\t\t\t\"data-closable\"\t\t:\tthis.closable,\n\t\t});\n\t}\n\tupdateDrag(event){\n\t\tthis.x+=event.movementX/Filament.scale;\n\t\tthis.y+=event.movementY/Filament.scale;\n\t}\n\tfinishDrag(event){\n\t\tif(this.edgeSnap){\n\t\t\tthis.x=Filament.minmax(0,Filament.settings.width-this.width,this.x);\n\t\t\tthis.y=Filament.minmax(0,Filament.settings.height-this.height,this.y);\n\t\t}\n\t}\n\tupdateResize(event){\n\t\tthis.width=Math.min(Filament.settings.width-this.x, this.width+event.movementX/Filament.scale);\n\t\tthis.height=Math.min(Filament.settings.height-this.y, this.height+event.movementY/Filament.scale);\n\t\tthis.resizing=false;\n\t}\n\n\tget text(){ return this.content.innerHTML; }\n\tset text(value){\n\n\t}\n}\n\nwindow.addEventListener('mousemove',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\tif (win.dragging){ win.updateDrag(event); }\n\t\tif (win.resizing){ win.updateResize(event); }\n\t}\n});\nwindow.addEventListener('mouseup',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\twin.dragging=false;\n\t\twin.finishDrag();\n\t}\n});","new Filament.Scene('home');\n\nFilament.scenes.home.start=function(){\n\tthis.window = new Filament.Window().mount(this);\n\tthis.window.width=100;\n\tthis.window.height=50;\n\tthis.window.x=50;\n\tthis.window.y=75;\n\tthis.window.resizable=true;\n\tthis.window.movable=true;\n\tthis.window.closable=true;\n\tthis.window.content.innerHTML=`Welcome to Filament!<br>\n\t<a href=\"javascript:void(Filament.scene='map');\">Map</a>`;\n\tnew Filament.Sprite('ebby.png').mount(this).assign({alpha:0.6});\n\tnew Filament.Sprite('ebby.png').mount(this).assign({x:20});\n}\n\nFilament.scenes.home.update=function(){\n\t\n}","new Filament.Scene('map');\n\nFilament.scenes.map.start=function(){\n\tFilament.map = new Filament.TileMap().mount(this);\n}\n\nFilament.scenes.map.update=function(){\n\t\n}","\nFilament.MapCellTexture = class extends PIXI.RenderTexture{\n\tconstructor(tilemap){\n\t\tsuper(new PIXI.BaseRenderTexture({\n\t\t\twidth: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\theight: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\tscaleMode: Filament.pixiScaleMode,\n\t\t}));\n\t\tthis.tilemap=tilemap;\n\t}\n};\n\nFilament.MapCellLayer = class extends PIXI.Sprite{\n\tconstructor(tilemap){\n\t\tsuper(new Filament.MapCellTexture(tilemap));\n\t}\n\tdestroy(){\n\t\tsuper.destroy(...arguments);\n\t\tthis.texture.destroy();\n\t}\n\tdrawTile(tileset,tx,ty,x,y){\n\t\tconst stamp = tileset.getStamp(tx,ty);\n\t\tstamp.position.set(x,y);\n\t\tFilament.pixi.renderer.render(stamp,this.texture);\n\t}\n}\n\n/**\n * An object representing an indivitual cell in the tilemap.\n * contains a reference to MapCellLayer objects for the base and fringe layers as well as\n * a list of all entities in the actorLayer associated with this cell.\n */\nFilament.MapCell = class{\n\tconstructor(tilemap){\n\t\tthis.tilemap=tilemap;\n\t\tthis.baseLayer=new Filament.MapCellLayer();\n\t\tthis.fringeLayer=new Filament.MapCellLayer();\n\t\ttilemap.baseLayer.addChild(this.baseLayer);\n\t\ttilemap.fringeLayer.addChild(this.fringeLayer);\n\t\tthis.loaded=false;\n\t\tthis.lastTileset=0;\n\t\tthis.texture = new MapCellTexture(this.tilemap);\n\t}\n\tasync load(){\n\t\t// load cell terrain and json\n\t\tthis.data=[];\n\t\tthis.actors=[];\n\n\t\t// loop through each tile stack in the data\n\t\tfor(let i=0;i<data.length;++i){\n\t\t\tconst stack = data[i];\n\t\t\tconst x=i%this.tilemap.cellSize;\n\t\t\tconst y=Math.floor(i/Math.tilemap.cellSize);\n\t\t\tif(stack instanceof Array){\n\t\t\t\tfor(const tile of stack){ await this.loadTile(tile,x,y); }\n\t\t\t}else{\n\t\t\t\tawait this.loadTile(stack,x,y);\n\t\t\t}\n\t\t}\n\t\tthis.loaded=true;\n\t}\n\tasync loadTile(tileData,x,y){\n\t\tconst tilesetId='ts' in tileData ? tileData.ts : this.lastTileset;\n\t\tif(tilesetId !== this.lastTileset){ this.lastTileset = tilesetId; }\n\t\tconst tileX=tileData.x;\n\t\tconst tileY=tileData.y;\n\t\tconst tileset=Filament.cache.requestTileset(tileId);\n\t\t// get tile layer data so we know how to draw it.\n\t\tconst layerType = tileset.getTile(tileX,tileY).layer;\n\t\tswitch(layerType){\n\t\tcase 0://base\n\t\t\tthis.baseLayer.drawTile(tileset,tileX,tileY,x,y);\n\t\t\tbreak;\n\t\tcase 1://actor\n\t\t\tbreak;\n\t\tcase 2://fringe\n\t\t\tbreak;\n\t\tcase 3://overpass\n\t\t\tbreak;\n\t\tdefault:\n\t\t}\n\t}\n\tunload(){\n\t\tthis.baseLayer.destroy();\n\t\tthis.fringeLayer.destroy();\n\t}\n}\n\nFilament.TileSet = class{\n\tconstructor(image,data){\n\t\tthis.image=image;\n\t\tthis.data=data;\n\t\tthis.stamp = new PIXI.Sprite(image);\n\t}\n\tgetStamp(x,y){\n\t\tconst ts=this.data.tileSize;\n\t\tthis.stamp.crop(x*ts,y*ts,ts,ts);\n\t\treturn this.stamp;\n\t}\n\tgetTile(x,y){\n\t\tconst row = this.data.data[y];\n\t\tif(!row){ return null; }\n\t\tlet tile = row[x];\n\t\tif(tile==undefined){ return null; }\n\t\tif( typeof tile==='number' ){\n\t\t\ttile={data:tile,note:''};\n\t\t}else if( tile.passage ){ return tile; }\n\t\ttile.passage = tile.data & 0b1111;\n\t\ttile.opaque = (tile.data>>>4) & 0b1;\n\t\ttile.layer = (tile.data>>>5) & 0b111;\n\t\ttile.terrain = tile.data>>>8;\n\t\trow[x]=tile;\n\t}\n}\n\n/**\n * The TileMap Class.\n * Each tilemap has multiple elevation layers.\n */\nFilament.TileMap = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.baseLayer = new PIXI.Container();\n\t\tthis.actorLayer = new PIXI.Container();\n\t\tthis.fringeLayer = new PIXI.Container();\n\t\tthis.cells = new Filament.CoordMap(2);\n\t\t// TODO: read map settings from JSON.\n\t\tthis.selector = new Filament.TileSelector().mount(this);\n\t\tthis.settings={\n\t\t\tname:'',\n\t\t\tcellSize:null,\n\t\t};\n\t}\n\tget cellSize(){\n\t\treturn this.settings.cellSize?this.settings.cellSize:Filament.settings.cellSize;\n\t}\n\tmount(){\n\t\tsuper.mount(...arguments);\n\t\tthis.selector.mountUI(this.scene);\n\t}\n}\n\n/*\nBetter idea for elevation.\nEverything is handled in one layer with tile stacks as usual.\n\nAn tile can be opaque or transparent.\nOpaque tiles erase underlying tiles when placed.\nTransparent tiles stack on top of underlying tiles.\n\nThere are four \"layering\" options for each tile.\nBase is rendered under player.\nActor is rendered same layer as player.\nFringe is rendered above player.\nOverpass is special. It's in the actor layer, but is rendered above or below the player depending on their elevation.\noverpass elevation is one plus the number of overpass tiles underlying in the stack.\nWhen player can step onto overpass tile, their elevation is set to same as the overpass they're walking on.\nWhen player can't step onto the overpass tile, they instead step under it.\n\n*/\n\nFilament.TileSelector = class extends Filament.UI{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('tileSelector');\n\t}\n}"]}