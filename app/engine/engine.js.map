{"version":3,"sources":["0_pixi_mod.js","1_options.js","1_utility.js","2_main.js","a_mixin_event.js","cache.js","class_0_ui.js","class_battler.js","class_keyboard.js","class_sprite.js","class_ui_scene.js","class_window.js","scene_home.js","tilemap.js"],"names":["PIXI","DisplayObject","prototype","enabled","enable","this","visible","disable","update","delta","z","Container","children","sort","a","b","child","Object","defineProperty","[object Object]","obj","Filament","Scene","parent","scene","addChild","Enum","values","value","SCALE_MODE","INDENT_MODE","settings","width","height","tileSize","cellSize","scaleMode","HYBRID","maintainAspectRatio","uiRes","tabSize","indentMode","TAB","configure","options","assign","loadSettings","async","fetch","json","truncateNumber","n","truncs","Math","floor","LARGE_NUMBER_ABBREVIATIONS","sleep","ms","Promise","resolve","setTimeout","minmax","min","max","val","round","places","func","factor","pow","ceil","arrayAdd","array","index","length","indexOf","splice","arrayRemove","mixin_object","target","mixin","implement","call","Function","_mixins","push","bind","instance","clazz","untag","s","v","Array","string","i","html","args","div","document","createElement","innerHTML","NodeList","childNodes","node","append","Element","match","element","id","reg","exec","classList","add","setAttribute","mount","mountElement","pixiCanvas","querySelector","parentElement","ui_container","getElementById","pixi","Application","view","backgroundColor","start","pixiContext","getContext","hybridCanvas","hybridContext","appendChild","style","opacity","body","setProperty","window","addEventListener","resize","ticker","scenes","elapsedMS","updateUI","render","drawImage","roundScale","scaleX","offsetWidth","scaleY","offsetHeight","scale","ratio1","renderer","imageSmoothingEnabled","transform","left","top","MixinEvents","events","eventname","create","event","eventlist","getEventList","callback","remove","EventInterface","removeEvent","Cache","_cache","key","requestAsset","gameFile","resource","texture","baseTexture","NORMAL","SCALE_MODES","LINEAR","NEAREST","url","reject","AssetLoader","addRequest","cache","loaders","Loader","super","_requests","load","loader","resources","request","error","AssetRequest","UI","ui","anchor","ObservablePoint","_onAnchorUpdate","setAccessor","position","v1","v2","destroy","parentNode","removeChild","name","String","getAttribute","getPropertyValue","attributes","properties","worldVisible","mountUI","Battler","stats","lethality","resilience","haste","spirit","luck","keyboard","keys","getKey","keygroup","keygroups","fireEvent","keyname","keyEventHandler","Key","addEventHandler","keydownHandler","keyupHandler","isDown","KeyGroup","keynames","addKey","Sprite","Texture","EMPTY","loadTexture","requestImage","activeScene","get","home","oldScene","game","enter","leave","stage","windows","Window","ui_width","ui_height","minwidth","minheight","maxwidth","maxheight","_hasFrame","_interactive","movable","resizable","closable","edgeSnap","content","handle","closeButton","dragging","contentObserver","MutationObserver","resizing","observe","attributeFilter","arguments","interactive","hasFrame","bounds","worldTransform","tx","x","ty","y","getBoundsUI","windex","setProperties","--width","--height","--x","--y","--z","--alpha","worldAlpha","setAttributes","data-frame","data-interactive","data-movable","data-resizable","data-closable","movementX","movementY","win","updateDrag","updateResize","alpha","MapCellTexture","RenderTexture"],"mappings":"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","file":"engine.js","sourcesContent":["PIXI.DisplayObject.prototype.enabled=true;\r\nPIXI.DisplayObject.prototype.enable=function(){\r\n\tthis.enabled=true;\r\n\tthis.visible=true;\r\n};\r\nPIXI.DisplayObject.prototype.disable=function(){\r\n\tthis.enabled=false;\r\n\tthis.visible=false;\r\n};\r\nPIXI.DisplayObject.prototype.update=function(delta){};\r\n\r\nPIXI.DisplayObject.prototype.z=0;\r\nPIXI.Container.prototype.update=function(delta){\r\n\tthis.children.sort((a,b)=>a.z-b.z);\r\n\tfor(const child of this.children){\r\n\t\tchild.update(delta);\r\n\t}\r\n};\r\n\r\nObject.defineProperty(PIXI.DisplayObject.prototype,'scene',{\r\n\tget(){\r\n\t\tlet obj=this;\r\n\t\twhile (!(obj instanceof Filament.Scene) && obj.parent){\r\n\t\t\tobj=obj.parent;\r\n\t\t}\r\n\t\treturn (obj instanceof Filament.Scene)?obj:null;\r\n\t},\r\n\tset(scene){\r\n\t\tif(this.scene===scene){ return; }\r\n\t\tscene.addChild(this);\r\n\t}\r\n});","Filament.Enum = class Enum{\r\n\tconstructor(...values){\r\n\t\tfor (const value of values){\r\n\t\t\tthis[value]=value;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nFilament.SCALE_MODE = new Filament.Enum(\r\n\t\"NORMAL\",\"NEAREST\",\"HYBRID\"\r\n);\r\nFilament.INDENT_MODE =  new Filament.Enum(\r\n\t\"TAB\",\"SPACE\"\r\n);\r\n\r\nFilament.settings = {\r\n\twidth: 320,\r\n\theight: 240,\r\n\ttileSize: 16,\r\n\tcellSize: 24,\r\n\tscaleMode: Filament.SCALE_MODE.HYBRID,\r\n\tmaintainAspectRatio: true,\r\n\tuiRes:1,\r\n\ttabSize:4,\r\n\tindentMode:Filament.INDENT_MODE.TAB,\r\n};\r\n\r\nFilament.configure=options=>{\r\n\tObject.assign(Filament.settings,options);\r\n};\r\n\r\nFilament.loadSettings=async function(){\r\n\tconst settings = await (await fetch(\"game/settings.json\")).json();\r\n\tFilament.configure(settings);\r\n};","Filament.truncateNumber=n=>{\r\n\tif(n<=99999){ return n+''; }\r\n\tlet truncs = 0;\r\n\twhile (n>9999 && truncs<5){\r\n\t\tn/=1000;\r\n\t\t++truncs;\r\n\t}\r\n\treturn Math.floor(n)+Filament.LARGE_NUMBER_ABBREVIATIONS[truncs];\r\n};\r\nFilament.LARGE_NUMBER_ABBREVIATIONS=[\r\n\t'','K','M','B','T','Q'\r\n];\r\nFilament.sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));\r\n\r\nFilament.minmax=(min,max,val)=>Math.max(min,Math.min(max,val));\r\n\r\nFilament.round=(value,places=0,func='round')=>{\r\n\tconst factor = Math.pow(10,places);\r\n\treturn Math[func](value*factor)/factor\r\n}\r\nFilament.floor=(value,places)=>Filament.round(value,places,'floor');\r\nFilament.ceil=(value,places)=>Filament.round(value,places,'ceil');\r\n\r\nFilament.arrayAdd=(array,obj,index=array.length)=>{\r\n\tif(array.indexOf(obj)>=0){ return true; }\r\n\tarray.splice(index,0,obj);\r\n\treturn false;\r\n}\r\n\r\nFilament.arrayRemove=(array,obj)=>{\r\n\tconst index=array.indexOf(obj);\r\n\tif(index>=0){\r\n\t\tarray.splice(index,1);\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nFilament.mixin_object=(target,mixin)=>{\r\n\tObject.assign(target,mixin);\r\n\tif(typeof mixin.implement === 'function'){ mixin.implement.call(target); }\r\n}\r\n\r\nFilament.mixin=(target,mixin)=>{\r\n\tif (!(target instanceof Function)){ return Filament.mixin_object(target,mixin); }\r\n\tif(!target._mixins){ target._mixins=[] }\r\n\ttarget._mixins.push(mixin);\r\n\tObject.assign(target.prototype,mixin);\r\n\ttarget.prototype.implement=Filament.implement.bind(this);\r\n}\r\nFilament.implement=function(instance,clazz){\r\n\tif (!instance || !clazz._mixins){ return; }\r\n\tfor (const mixin of clazz._mixins){\r\n\t\tif(typeof mixin.implement === 'function'){ mixin.implement.call(instance); }\r\n\t}\r\n}\r\n\r\nFilament.untag=(s,...v)=>{\r\n\tif(!(s instanceof Array)){ return s; }\r\n\tlet string = '';\r\n\tfor (const i in s){ string+=s[i]+(v[i]||''); }\r\n\treturn string;\r\n}\r\n\r\nFilament.html=(...args)=>{\r\n\tconst string = untag(...args);\r\n\tconst div = document.createElement('div');\r\n\tdiv.innerHTML=string;\r\n\treturn new Filament.NodeList(...div.childNodes);\r\n}\r\n\r\nFilament.NodeList=class extends Array{\r\n\tmount(target){\r\n\t\tfor (const node of this){\r\n\t\t\ttarget.append(node);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\telements(){\r\n\t\tlet array = [];\r\n\t\tfor (const node of this){\r\n\t\t\tif(node instanceof Element){ array.push(node); }\r\n\t\t}\r\n\t\treturn array;\r\n\t}\r\n}\r\n\r\nFilament.createElement=(string,child)=>{\r\n\tlet match = string.match(/^[^\\s.#[\\]]+/);\r\n\tif(!match){throw `Couldn't find tagname in string ${string}`;}\r\n\tconst element = document.createElement(match[0]);\r\n\tmatch=string.match(/#([^\\s.#[\\]]+)/);\r\n\tif(match){ element.id=match[1]; }\r\n\tlet reg=/\\.([^\\s.#[\\]]+)/g;\r\n\twhile(match=reg.exec(string)){\r\n\t\telement.classList.add(match[1]);\r\n\t}\r\n\treg=/\\[([^\\s.#[\\]=]+)=([^\\s.#[\\]=]+)\\]/g;\r\n\twhile(match=reg.exec(string)){\r\n\t\telement.setAttribute(match[1],match[2]);\r\n\t}\r\n\tif(child){ element.append(child); }\r\n\telement.mount=Filament.mountElement;\r\n\treturn element;\r\n}\r\n\r\nFilament.mountElement=function(target){\r\n\tif(!(this instanceof Element)){ return; }\r\n\ttarget.append(this);\r\n\treturn this;\r\n};","Filament.pixiCanvas = document.querySelector(\"#screen-game canvas\");\r\nFilament.parent = Filament.pixiCanvas.parentElement;\r\nFilament.ui_container = document.getElementById(\"ui-container\");\r\nFilament.pixi = new PIXI.Application({\r\n\tview: Filament.pixiCanvas,\r\n\twidth: Filament.settings.width,\r\n\theight: Filament.settings.height,\r\n\tbackgroundColor:0x000088\r\n});\r\n\r\nFilament.start=async function(){\r\n\tawait Filament.loadSettings();\r\n\tFilament.pixiContext = Filament.pixiCanvas.getContext(\"2d\");\r\n\tif( Filament.settings.scaleMode === Filament.SCALE_MODE.HYBRID ){\r\n\t\tFilament.hybridCanvas = document.createElement('canvas');\r\n\t\tFilament.hybridContext = Filament.hybridCanvas.getContext(\"2d\");\r\n\t\tFilament.hybridCanvas.id=\"hybrid-canvas\";\r\n\t\tFilament.pixiCanvas.parentElement.appendChild(Filament.hybridCanvas);\r\n\t\tFilament.pixiCanvas.style.opacity=0;\r\n\t}\r\n\tdocument.body.style.setProperty('--uiRes',Filament.settings.uiRes);\r\n\tdocument.body.style.setProperty('--screen-width',Filament.settings.width);\r\n\tdocument.body.style.setProperty('--screen-height',Filament.settings.height);\r\n\r\n\tFilament.ui_container.style.width = Filament.settings.width*Filament.settings.uiRes+\"px\";\r\n\tFilament.ui_container.style.height = Filament.settings.height*Filament.settings.uiRes+\"px\";\r\n\r\n\twindow.addEventListener('resize',Filament.resize);\r\n\tFilament.resize();\r\n\tFilament.ticker = Filament.pixi.ticker.add(Filament.update,Filament);\r\n\r\n\tfor (const scene of Object.values(Filament.scenes)){\r\n\t\tscene.start();\r\n\t}\r\n};\r\n\r\nFilament.update=()=>{\r\n\tconst delta = Filament.ticker.elapsedMS/1000;\r\n\r\n\tif(Filament.scene){\r\n\t\tFilament.scene.update(delta);\r\n\t\tFilament.scene.updateUI(delta);\r\n\t}\r\n\r\n\tif(Filament.hybridCanvas){\r\n\t\tFilament.pixi.render();\r\n\t\tFilament.hybridContext.drawImage(\r\n\t\t\tFilament.pixiCanvas,\r\n\t\t\t0,0, Filament.settings.width, Filament.settings.height,\r\n\t\t\t0,0, Filament.hybridCanvas.width, Filament.hybridCanvas.height\r\n\t\t);\r\n\t}\r\n};\r\n\r\nFilament.roundScale=n=>Math.round(n)||1;\r\n\r\nFilament.resize=()=>{\r\n\tlet scaleX = Filament.parent.offsetWidth / Filament.settings.width;\r\n\tlet scaleY = Filament.parent.offsetHeight / Filament.settings.height;\r\n\tlet scale = Math.min(scaleX,scaleY);\r\n\tif(Filament.settings.maintainAspectRatio){\r\n\t\tscaleX = scaleY = scale;\r\n\t}else{\r\n\t\tlet ratio1 = Filament.parent.offsetWidth/Filament.parent.offsetHeight;\r\n\t\tlet ratio2 = Filament.settings.width/Filament.settings.height;\r\n\t\tif(ratio1>ratio2){//wide\r\n\t\t\tFilament.pixi.renderer.resize(\r\n\t\t\t\tFilament.settings.height*ratio1,\r\n\t\t\t\tFilament.settings.height\r\n\t\t\t);\r\n\t\t}else{ //tall\r\n\t\t\tFilament.pixi.renderer.resize(\r\n\t\t\t\tFilament.settings.width,\r\n\t\t\t\tFilament.settings.width/ratio1\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tFilament.scaleX=scaleX;\r\n\tFilament.scaleY=scaleY;\r\n\tFilament.scale=scale;\r\n\t\r\n\tFilament.pixiCanvas.style.width = Filament.settings.width*scaleX+\"px\";\r\n\tFilament.pixiCanvas.style.height = Filament.settings.height*scaleY+\"px\";\r\n\tif(Filament.hybridCanvas){\r\n\t\tFilament.hybridCanvas.width = Filament.settings.width*Filament.roundScale(scaleX);\r\n\t\tFilament.hybridCanvas.height = Filament.settings.height*Filament.roundScale(scaleY);\r\n\t\tFilament.hybridCanvas.style.width = Filament.pixiCanvas.style.width;\r\n\t\tFilament.hybridCanvas.style.height = Filament.pixiCanvas.style.height;\r\n\t\tFilament.hybridContext.imageSmoothingEnabled=false;\r\n\t}\r\n\tFilament.ui_container.style.transform=\"scale(\"+scale/Filament.settings.uiRes+\")\";\r\n\tFilament.ui_container.style.left=\r\n\t\tFilament.parent.offsetWidth/2 - Filament.ui_container.offsetWidth/2+\"px\";\r\n\tFilament.ui_container.style.top=\r\n\t\tFilament.parent.offsetHeight/2 - Filament.ui_container.offsetHeight/2+\"px\";\r\n};","Filament.MixinEvents={\r\n\timplement(){\r\n\t\tthis.events={};\r\n\t},\r\n\tgetEventList(eventname,create){\r\n\t\tif(!(eventname in this.events) && create){\r\n\t\t\tthis.events[eventname]=[];\r\n\t\t}\r\n\t\treturn this.events[eventname];\r\n\t},\r\n\tfireEvent(eventname,event={}){\r\n\t\tconst eventlist=this.getEventList(eventname,false);\r\n\t\tif(!eventlist){ return; }\r\n\t\tfor (const callback in eventlist){\r\n\t\t\tevent.remove=Filament.EventInterface.removeEvent.bind(this,eventname,callback);\r\n\t\t\tif(typeof callback === 'function'){ callback(event); }\r\n\t\t}\r\n\t},\r\n\taddEvent(eventname,callback){\r\n\t\treturn Filament.arrayAdd(this.getEventList(eventname,true),callback);\r\n\t},\r\n\tremoveEvent(eventname,callback){\r\n\t\tconst eventlist = this.getEventList(eventname,false);\r\n\t\tif(!eventlist){ return false; }\r\n\t\treturn Filament.arrayRemove(this.events[eventname],callback);\r\n\t}\r\n}","Filament.Cache=class{\r\n\tconstructor(){\r\n\t\tthis._cache={};\r\n\t}\r\n\r\n\tasync requestImage(key){\r\n\t\tkey=`assets/img/${key}`;\r\n\t\treturn await this.requestAsset(key,Filament.gameFile(key),(resource)=>{\r\n\t\t\tresource.texture.baseTexture.scaleMode=Filament.settings.scaleMode===Filament.SCALE_MODE.NORMAL ? PIXI.SCALE_MODES.LINEAR : PIXI.SCALE_MODES.NEAREST;\r\n\t\t\treturn resource.texture;\r\n\t\t});\r\n\t}\r\n\tasync requestAudio(key){\r\n\t\t\r\n\t}\r\n\trequestAsset(key,url,callback){\r\n\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\tif(!this._cache[key]){\r\n\t\t\t\tthis._cache[key]=new Filament.AssetLoader(key,url,this);\r\n\t\t\t}\r\n\t\t\tif(this._cache[key] instanceof Filament.AssetLoader){\r\n\t\t\t\tthis._cache[key].addRequest(resolve,reject,callback);\r\n\t\t\t}else{\r\n\t\t\t\tresolve(callback(this._cache[key]));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nFilament.cache=new Filament.Cache();\r\n\r\nFilament.AssetLoader=class extends PIXI.loaders.Loader{\r\n\tconstructor(key,url,cache){\r\n\t\tsuper();\r\n\t\tthis.add(key,url);\r\n\t\tthis._requests=[];\r\n\t\tthis.load((loader,resources)=>{\r\n\t\t\tconst resource=resources[key];\r\n\t\t\tfor (const request of this._requests){\r\n\t\t\t\tif(resource.error){\r\n\t\t\t\t\trequest.reject(resource.error);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trequest.resolve(request.callback(resource));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(resource.error){\r\n\t\t\t\tdelete cache._cache[key];\r\n\t\t\t}else{\r\n\t\t\t\tcache._cache[key]=resource;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\taddRequest(resolve,reject,callback){\r\n\t\tthis._requests.push(new Filament.AssetRequest(resolve,reject,callback));\r\n\t}\r\n}\r\n\r\nFilament.AssetRequest=class{\r\n\tconstructor(resolve,reject,callback){\r\n\t\tthis.resolve=resolve;\r\n\t\tthis.reject=reject;\r\n\t\tthis.callback=callback;\r\n\t}\r\n}","Filament.UI = class extends PIXI.Container{\r\n\tconstructor(){\r\n\t\tsuper();\r\n\t\tthis.ui = document.createElement('div');\r\n\t\tthis.anchor = new PIXI.ObservablePoint(this._onAnchorUpdate, this);\r\n\t\tthis.setAccessor('id');\r\n\t\tthis.setAccessor('className');\r\n\t\tthis.classList=this.ui.classList;\r\n\t\tthis.style=this.ui.style;\r\n\t\tthis.style.position=\"absolute\";\r\n\t}\r\n\tmount(parent){\r\n\t\tparent.addChild(this);\r\n\t\treturn this;\r\n\t}\r\n\tmountUI(parent){\r\n\t\t(parent instanceof Filament.UI ? parent.ui : parent).append(this.ui);\r\n\t\treturn this;\r\n\t}\r\n\tsetAccessor(v1,v2=v1){\r\n\t\tObject.defineProperty(this,v1,{\r\n\t\t\tget(){return this.ui[v2];},\r\n\t\t\tset(v){this.ui[v2]=v;}\r\n\t\t});\r\n\t}\r\n\tenable(){\r\n\t\tsuper.enable();\r\n\t\tthis.setAttribute('data-enabled',true);\r\n\t}\r\n\tdisable(){\r\n\t\tsuper.disable();\r\n\t\tthis.setAttribute('data-enabled',false);\r\n\t}\r\n\tdestroy(){\r\n\t\tsuper.destroy();\r\n\t\tthis.ui.parentNode.removeChild(this.ui);\r\n\t}\r\n\tsetAttribute(name,value){\r\n\t\tvalue=String(value);\r\n\t\tif(this.ui.getAttribute(name)!==value){\r\n\t\t\tthis.ui.setAttribute(name,value);\r\n\t\t}\r\n\t}\r\n\tsetProperty(name,value){\r\n\t\tvalue=String(value);\r\n\t\tif(this.ui.style.getPropertyValue(name)!==value){\r\n\t\t\tthis.ui.style.setProperty(name,value);\r\n\t\t}\r\n\t}\r\n\tsetAttributes(attributes){\r\n\t\tfor (const key in attributes){ this.setAttribute(key,attributes[key]); }\r\n\t}\r\n\tsetProperties(properties){\r\n\t\tfor (const key in properties){ this.setProperty(key,properties[key]); }\r\n\t}\r\n\tupdateUI(delta){\r\n\t\tthis.setAttribute(\"data-visible\",this.worldVisible);\r\n\t\tif(!this.ui.parentNode && this.scene && this.scene!==this){ this.mountUI(this.scene); }\r\n\t}\r\n\t_onAnchorUpdate(){\r\n\t\t//this.ui.style.transform = \"translate(\"+-this.anchor.x*100+\"%,\"+-this.anchor.y*100+\"%)\";\r\n\t}\r\n}","/* NOTES\r\nLethality (attack power)\r\nResilience (hp and def)\r\nHaste (SP)\r\nSpirit (MP)\r\n\r\nhidden stats:\r\nLuck\r\n\r\n\r\nEquipment types:\r\nWeapon\r\nArmor\r\nAccessory\r\n*/\r\n\r\nFilament.Battler = class{\r\n\tconstructor(){\r\n\t\tthis.stats={\r\n\t\t\tlethality:0,\r\n\t\t\tresilience:0,\r\n\t\t\thaste:0,\r\n\t\t\tspirit:0,\r\n\t\t\tluck:0,\r\n\t\t};\r\n\t}\r\n};","Filament.keyboard={\r\n\tkeys:{},\r\n\tkeyEventHandler(eventname,event){\r\n\t\tconst key = this.getKey(event.key,false);\r\n\t\tif(typeof key[eventname] === 'function')key[eventname]();\r\n\t\tfor (const keygroup of key.keygroups){\r\n\t\t\tkeygroup.fireEvent(eventname,event);\r\n\t\t}\r\n\t},\r\n\taddEventHandler(keyname){\r\n\t\tthis[`${keyname}Handler`]=this.keyEventHandler.bind(this,keyname);\r\n\t},\r\n\tgetKey(keyname,create){\r\n\t\tif(!(keyname in this.keys) && create){\r\n\t\t\tthis.keys[keyname]=new Filament.Key(keyname);\r\n\t\t}\r\n\t\treturn this.keys[keyname];\r\n\t}\r\n};\r\nFilament.keyboard.addEventHandler('keydown');\r\nFilament.keyboard.addEventHandler('keyup');\r\n\r\nFilament.parent.addEventListener('keydown',Filament.keyboard.keydownHandler);\r\nFilament.parent.addEventListener('keyup',Filament.keyboard.keyupHandler);\r\n\r\nFilament.Key = class{\r\n\tconstructor(name){\r\n\t\tthis.name=name;\r\n\t\tthis.isDown=false;\r\n\t\tthis.keygroups=[];\r\n\t}\r\n\tkeydown(){\r\n\t\tthis.isDown=true;\r\n\t}\r\n\tkeyup(){\r\n\t\tthis.isDown=false;\r\n\t}\r\n}\r\n\r\nFilament.KeyGroup = class{\r\n\tconstructor(name,keynames=[]){\r\n\t\tthis.name=name;\r\n\t\tthis.keys=[];\r\n\t\tfor (const keyname of keynames){\r\n\t\t\tthis.addKey(keyname);\r\n\t\t}\r\n\t\t//Filament.mixin(this,Filament.EventMixin);\r\n\t\tthis.implement(Filament.KeyGroup);\r\n\t}\r\n\taddKey(keyname){\r\n\t\tconst key = Filament.keyboard.getKey(keyname,true);\r\n\t\tFilament.arrayAdd(key.keygroups,this);\r\n\t\tFilament.arrayAdd(this.keys,key);\r\n\t}\r\n\tremoveKey(keyname){\r\n\t\tconst key = Filament.keyboard.getKey(keyname,false);\r\n\t\tif(!key){ return; }\r\n\t\tFilament.arrayRemove(key.keygroups,this);\r\n\t\tFilament.arrayRemove(this.keys,key);\r\n\t}\r\n\tget isDown(){\r\n\t\tfor (const key in this.keys){\r\n\t\t\tif(key.isDown){ return true; }\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\nFilament.mixin(Filament.KeyGroup, Filament.MixinEvents);","Filament.Sprite = class extends PIXI.Sprite{\r\n\tconstructor(key){\r\n\t\tsuper(PIXI.Texture.EMPTY);\r\n\t\tthis.loadTexture(key);\r\n\t}\r\n\tasync loadTexture(key){\r\n\t\tthis.texture=await Filament.cache.requestImage(key);\r\n\t}\r\n\tmount(parent){\r\n\t\tparent.addChild(this);\r\n\t\treturn this;\r\n\t}\r\n}","Filament.scenes={};\r\nFilament.activeScene=\"home\";\r\nObject.defineProperty(Filament,\"scene\",{\r\n\tget:()=>Filament.scenes[Filament.activeScene]||Filament.scenes.home,\r\n\tset(value){\r\n\t\tconst oldScene=Filament.activeScene;\r\n\t\tif(value in Filament.scenes){\r\n\t\t\tFilament.activeScene=value;\r\n\t\t}else{\r\n\t\t\tfor (const key in Filament.scenes){\r\n\t\t\t\tif(value===game.scenes[key]){\r\n\t\t\t\t\tFilament.activeScene=key;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Filament.activeScene===oldScene){ return; }\r\n\t\tfor (const scene of Filament.scenes){\r\n\t\t\tif(Filament.activeScene===scene.name){\r\n\t\t\t\tscene.enable();\r\n\t\t\t\tscene.enter();\r\n\t\t\t}else if (scene.enabled){\r\n\t\t\t\tscene.disable();\r\n\t\t\t\tscene.leave();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n\r\nFilament.ui_container = document.getElementById(\"ui-container\");\r\n\r\nFilament.Scene = class extends Filament.UI{\r\n\tconstructor(name){\r\n\t\tsuper();\r\n\t\tthis.mountUI(Filament.ui_container);\r\n\t\tthis.mount(Filament.pixi.stage);\r\n\t\tFilament.scenes[name] = this;\r\n\t\tthis.id=\"scene-\"+name;\r\n\t\tthis.classList.add(\"scene\");\r\n\t\tthis.name=name;\r\n\t\tthis.windows=[];\r\n\t}\r\n\tupdateUI(delta){\r\n\t\tsuper.updateUI(delta);\r\n\t\tfor (let i=this.windows.length-1; i>=0; --i){\r\n\t\t\tthis.windows[i].updateUI(delta);\r\n\t\t}\r\n\t}\r\n\tstart(){}\r\n\tenter(){}\r\n\tleave(){}\r\n}","Filament.Window = class extends Filament.UI{\r\n\tconstructor(){\r\n\t\tsuper();\r\n\t\tthis.classList.add('window');\r\n\t\tthis.ui_width=20;\r\n\t\tthis.ui_height=20;\r\n\t\tthis.minwidth=20;\r\n\t\tthis.minheight=20;\r\n\t\tthis.maxwidth=Filament.settings.width;\r\n\t\tthis.maxheight=Filament.settings.height;\r\n\t\tthis._hasFrame=false;\r\n\t\tthis._interactive=false;\r\n\t\tthis.movable=false;\r\n\t\tthis.resizable=false;\r\n\t\tthis.closable=false;\r\n\t\tthis.edgeSnap=true;\r\n\t\tthis.content=Filament.createElement('div.content').mount(this.ui);\r\n\t\tthis.handle=Filament.createElement('div.handle').mount(this.ui);\r\n\t\tthis.closeButton=Filament.createElement('div.closeButton','Ã—').mount(this.ui);\r\n\t\tthis.closeButton.addEventListener('click',event=>{\r\n\t\t\tthis.destroy();\r\n\t\t});\r\n\t\tthis.handle.addEventListener('mousedown',event=>{\r\n\t\t\tFilament.arrayRemove(this.scene.windows,this);\r\n\t\t\tFilament.arrayAdd(this.scene.windows,this);\r\n\t\t\tthis.dragging=true;\r\n\t\t});\r\n\t\tthis.handle.addEventListener('mouseup',event=>{\r\n\t\t\tthis.dragging=false;\r\n\t\t});\r\n\t\tthis.contentObserver=new MutationObserver(()=>{\r\n\t\t\tif(this.resizable){\r\n\t\t\t\tif(this.content.style.width||this.content.style.height){\r\n\t\t\t\t\tthis.content.style.width='';\r\n\t\t\t\t\tthis.content.style.height='';\r\n\t\t\t\t\tthis.resizing=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.contentObserver.observe(this.content,{attributes:true,attributeFilter:['style']});\r\n\t}\r\n\tmount(parent){\r\n\t\tsuper.mount(parent);\r\n\t\tif(parent.scene)this.mountUI(this.scene);\r\n\t\treturn this;\r\n\t}\r\n\tmountUI(scene){\r\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\r\n\t\tsuper.mountUI(scene);\r\n\t\tFilament.arrayAdd(scene.windows,this);\r\n\t\treturn this;\r\n\t}\r\n\tdestroy(){\r\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\r\n\t\tsuper.destroy(...arguments);\r\n\t}\r\n\tget width(){return this.ui_width;}\r\n\tset width(v){this.ui_width=v;}\r\n\tget height(){return this.ui_height;}\r\n\tset height(v){this.ui_height=v;}\r\n\tget interactive(){return this._interactive||this.movable||this.resizable||this.closable;}\r\n\tset interactive(v){this._interactive=v;}\r\n\tget hasFrame(){return this._hasFrame||this.movable||this.resizable||this.closable;}\r\n\tset hasFrame(v){this._hasFrame=v;}\r\n\tgetBoundsUI(){\r\n\t\tlet bounds = {};\r\n\t\tbounds.width = Filament.round(this.width,2);\r\n\t\tbounds.height = Filament.round(this.height,2);\r\n\t\tbounds.left=Filament.round(this.worldTransform.tx-this.anchor.x*bounds.width,2);\r\n\t\tbounds.top=Filament.round(this.worldTransform.ty-this.anchor.y*bounds.height,2);\r\n\t\treturn bounds;\r\n\t}\r\n\tupdateUI(delta){\r\n\t\tsuper.updateUI(delta);\r\n\t\tif(this.edgeSnap){\r\n\t\t\tthis.x=Filament.minmax(0,Filament.settings.width-this.width,this.x);\r\n\t\t\tthis.y=Filament.minmax(0,Filament.settings.height-this.height,this.y);\r\n\t\t}\r\n\t\tif(this.resizable){\r\n\t\t\tthis.width=Filament.minmax(this.minwidth,this.maxwidth,this.width);\r\n\t\t\tthis.height=Filament.minmax(this.minheight,this.maxheight,this.height);\r\n\t\t}\r\n\t\tlet bounds = this.getBoundsUI(true);\r\n\t\tconst windex = this.scene.windows.indexOf(this);\r\n\t\tthis.setProperties({\r\n\t\t\t\"--width\"\t:\tbounds.width,\r\n\t\t\t\"--height\"\t:\tbounds.height,\r\n\t\t\t\"--x\"\t\t:\tbounds.left,\r\n\t\t\t\"--y\"\t\t:\tbounds.top,\r\n\t\t\t\"--z\"\t\t:\tthis.z+windex/1000,\r\n\t\t\t\"--alpha\"\t:\tthis.worldAlpha,\r\n\t\t});\r\n\t\tthis.setAttributes({\r\n\t\t\t\"data-frame\"\t\t:\tthis.hasFrame,\r\n\t\t\t\"data-interactive\"\t:\tthis.interactive,\r\n\t\t\t\"data-movable\"\t\t:\tthis.movable,\r\n\t\t\t\"data-resizable\"\t:\tthis.resizable,\r\n\t\t\t\"data-closable\"\t\t:\tthis.closable,\r\n\t\t});\r\n\t}\r\n\tupdateDrag(event){\r\n\t\tthis.x+=event.movementX/Filament.scale;\r\n\t\tthis.y+=event.movementY/Filament.scale;\r\n\t}\r\n\tupdateResize(event){\r\n\t\tthis.width=Math.min(Filament.settings.width-this.x, this.width+event.movementX/Filament.scale);\r\n\t\tthis.height=Math.min(Filament.settings.height-this.y, this.height+event.movementY/Filament.scale);\r\n\t\tthis.resizing=false;\r\n\t}\r\n}\r\n\r\nwindow.addEventListener('mousemove',event=>{\r\n\tif(!Filament.scene){ return; }\r\n\tfor (const win of Filament.scene.windows){\r\n\t\tif (win.dragging){ win.updateDrag(event); }\r\n\t\tif (win.resizing){ win.updateResize(event); }\r\n\t}\r\n});\r\nwindow.addEventListener('mouseup',event=>{\r\n\tif(!Filament.scene){ return; }\r\n\tfor (const win of Filament.scene.windows){\r\n\t\twin.dragging=false;\r\n\t}\r\n});","new Filament.Scene('home');\r\n\r\nFilament.scenes.home.start=function(){\r\n\tthis.window = new Filament.Window().mount(this);\r\n\tthis.window.width=100;\r\n\tthis.window.height=50;\r\n\tthis.window.x=50;\r\n\tthis.window.y=25;\r\n\tthis.window.resizable=true;\r\n\tthis.window.movable=true;\r\n\tthis.window.closable=true;\r\n\tthis.window.content.append(\"Hello World\");\r\n\tnew Filament.Sprite('ebby.png').mount(this).alpha=0.6;\r\n\tnew Filament.Sprite('ebby.png').mount(this).x=20;\r\n}\r\n\r\nFilament.scenes.home.update=function(){\r\n\t\r\n}","\r\nFilament.MapCellTexture = class extends PIXI.RenderTexture{\r\n\r\n};"]}