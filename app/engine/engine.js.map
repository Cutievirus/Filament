{"version":3,"sources":["0_pixi_mod.js","1_options.js","1_utility.js","2_main.js","a_mixin_event.js","a_mixin_util.js","cache.js","class_0_ui.js","class_battler.js","class_sprite.js","class_ui_scene.js","class_window.js","input_keyboard.js","input_mouse.js","scene_home.js","scene_map.js","tilemap.js"],"names":["PIXI","DisplayObject","prototype","enabled","enable","this","visible","disable","update","delta","zIndex","Container","children","sort","a","b","child","Object","defineProperty","[object Object]","obj","Filament","Scene","parent","scene","addChild","Texture","crop","x","y","w","h","rect","arguments","length","Rectangle","baseTexture","Sprite","texture","Enum","values","value","SCALE_MODE","settings","width","height","tileSize","cellSize","scaleMode","HYBRID","maintainAspectRatio","uiRes","language","configure","options","assign","loadSettings","async","fetch","gameFile","json","body","document","style","setProperty","defineProperties","pixiScaleMode","get","NORMAL","SCALE_MODES","LINEAR","NEAREST","truncateNumber","n","truncs","Math","floor","LARGE_NUMBER_ABBREVIATIONS","sleep","ms","Promise","resolve","setTimeout","minmax","min","max","val","round","places","func","factor","pow","ceil","roundFactor","floorFactor","ceilFactor","arrayAdd","array","index","indexOf","splice","arrayRemove","target","mixins","mixin","field","mixin_object","implement","call","Function","_mixins","push","bind","instance","clazz","untag","s","v","Array","string","i","html","args","div","createElement","innerHTML","NodeList","childNodes","node","append","Element","match","element","id","reg","exec","classList","add","setAttribute","mount","mountElement","handler","construct","isConstructor","f","Boolean","Proxy","err","CoordMap","dimensions","dfault","defaultArgs","data","yz","_getValue","_getSubDimension","set","subdimension","unset","keys","has","pixiCanvas","querySelector","parentElement","ui_container","getElementById","pixi","Application","view","backgroundColor","start","pixiContext","getContext","hybridCanvas","hybridContext","appendChild","opacity","window","addEventListener","resize","ticker","scenes","elapsedMS","updateUI","render","drawImage","roundScale","scaleX","offsetWidth","scaleY","offsetHeight","scale","ratio1","renderer","imageSmoothingEnabled","MixinEvents","events","eventname","create","event","eventlist","getEventList","callback","remove","removeEvent","MixinEventHandler","fireEvent","addListener","eventHandler","MixinUtil","key","Cache","_cache","path","gameAsset","resource","requestJSON","image","requestImage","TileSet","requestAsset","url","reject","AssetLoader","addRequest","cache","loaders","Loader","super","_requests","load","loader","resources","request","error","AssetRequest","UI","ui","anchor","ObservablePoint","_onAnchorUpdate","setAccessor","position","v1","v2","destroy","parentNode","removeChild","name","String","getAttribute","getPropertyValue","attributes","properties","worldVisible","mountUI","Battler","stats","lethality","resilience","haste","spirit","luck","EMPTY","loadTexture","activeScene","home","oldScene","enter","leave","stage","windows","Window","ui_width","ui_height","minwidth","minheight","maxwidth","maxheight","_hasFrame","_interactive","movable","resizable","closable","edgeSnap","content","handle","closeButton","teletype","dragging","finishDrag","contentObserver","MutationObserver","resizing","observe","attributeFilter","interactive","hasFrame","bounds","left","worldTransform","tx","top","ty","getBoundsUI","windex","setProperties","--width","--height","--x","--y","--z","--alpha","worldAlpha","setAttributes","data-frame","data-interactive","data-movable","data-resizable","data-closable","movementX","movementY","text","win","updateDrag","updateResize","keyboard","getKey","code","keygroup","keygroups","keyname","Key","addEventHandler","isDown","KeyGroup","keynames","addKey","mouse","canvasBounds","getBoundingClientRect","canvasX","clientX","canvasY","clientY","alpha","map","TileMap","MapCellTexture","RenderTexture","tilemap","BaseRenderTexture","MapCellLayer","tileset","stamp","getStamp","MapCell","baseLayer","fringeLayer","loaded","lastTileset","actors","stack","tile","loadTile","tileData","tilesetId","ts","tileX","tileY","requestTileset","getTile","layer","drawTile","row","undefined","note","passage","opaque","terrain","actorLayer","cells","selector","TileSelector","addEvent","mouseMove"],"mappings":"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","file":"engine.js","sourcesContent":["PIXI.DisplayObject.prototype.enabled=true;\nPIXI.DisplayObject.prototype.enable=function(){\n\tthis.enabled=true;\n\tthis.visible=true;\n};\nPIXI.DisplayObject.prototype.disable=function(){\n\tthis.enabled=false;\n\tthis.visible=false;\n};\nPIXI.DisplayObject.prototype.update=function(delta){};\n\nPIXI.DisplayObject.prototype.zIndex=0;\nPIXI.Container.prototype.update=function(delta){\n\tthis.children.sort((a,b)=>a.zIndex-b.zIndex);\n\tfor(const child of this.children){\n\t\tchild.update(delta);\n\t}\n};\n\nObject.defineProperty(PIXI.DisplayObject.prototype,'scene',{\n\tget(){\n\t\tlet obj=this;\n\t\twhile (!(obj instanceof Filament.Scene) && obj.parent){\n\t\t\tobj=obj.parent;\n\t\t}\n\t\treturn (obj instanceof Filament.Scene)?obj:null;\n\t},\n\tset(scene){\n\t\tif(this.scene===scene){ return; }\n\t\tscene.addChild(this);\n\t}\n});\n\nPIXI.Texture.prototype.crop=function(x,y,w,h){\n\tconst rect = arguments.length===1?x:new PIXI.Rectangle(x,y,w,h);\n\treturn new PIXI.Texture(this.baseTexture,rect);\n}\n\nPIXI.Sprite.prototype.crop=function(){\n\tthis.texture = this.texture.crop(...arguments);\n}","Filament.Enum = class Enum{\n\tconstructor(...values){\n\t\tfor (const value of values){\n\t\t\tthis[value]=value;\n\t\t}\n\t}\n};\n\nFilament.SCALE_MODE = new Filament.Enum(\n\t\"NORMAL\",\"NEAREST\",\"HYBRID\"\n);\n\nFilament.settings = {\n\twidth: 320,\n\theight: 240,\n\ttileSize: 16,\n\tcellSize: 24,\n\tscaleMode: Filament.SCALE_MODE.HYBRID,\n\tmaintainAspectRatio: true,\n\tuiRes:1,\n\tlanguage:'en',\n};\n\nFilament.configure=options=>{\n\tObject.assign(Filament.settings,options);\n};\n\nFilament.loadSettings=async function(){\n\tconst settings = await (await fetch(Filament.gameFile('settings.json'))).json();\n\tFilament.configure(settings);\n\n\tconst body = document.body.style;\n\tbody.setProperty('--uiRes',Filament.settings.uiRes);\n\tbody.setProperty('--screen-width',Filament.settings.width);\n\tbody.setProperty('--screen-height',Filament.settings.height);\n\tbody.setProperty('--tileSize',Filament.settings.tileSize);\n};\n\nObject.defineProperties(Filament,{\n\tpixiScaleMode:{\n\t\tget:()=>Filament.settings.scaleMode===Filament.SCALE_MODE.NORMAL ? PIXI.SCALE_MODES.LINEAR : PIXI.SCALE_MODES.NEAREST\n\t}\n});","Filament.truncateNumber=n=>{\n\tif(n<=99999){ return n+''; }\n\tlet truncs = 0;\n\twhile (n>9999 && truncs<5){\n\t\tn/=1000;\n\t\t++truncs;\n\t}\n\treturn Math.floor(n)+Filament.LARGE_NUMBER_ABBREVIATIONS[truncs];\n};\nFilament.LARGE_NUMBER_ABBREVIATIONS=[\n\t'','K','M','B','T','Q'\n];\nFilament.sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));\n\nFilament.minmax=(min,max,val)=>Math.max(min,Math.min(max,val));\n\nFilament.round=(value,places=0,func='round')=>{\n\tconst factor = Math.pow(10,places);\n\treturn Math[func](value*factor)/factor\n}\nFilament.floor=(value,places)=>Filament.round(value,places,'floor');\nFilament.ceil=(value,places)=>Filament.round(value,places,'ceil');\n\nFilament.roundFactor=(value,factor=1,func='round')=>Math[func](value/factor)*factor;\nFilament.floorFactor=(value,factor)=>Filament.roundFactor(value,factor,'floor');\nFilament.ceilFactor=(value,factor)=>Filament.roundFactor(value,factor,'ceil');\n\nFilament.arrayAdd=(array,obj,index=array.length)=>{\n\tif(array.indexOf(obj)>=0){ return true; }\n\tarray.splice(index,0,obj);\n\treturn false;\n}\n\nFilament.arrayRemove=(array,obj)=>{\n\tconst index=array.indexOf(obj);\n\tif(index>=0){\n\t\tarray.splice(index,1);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n/**\n * Like Object.assign, except doesn't overwrite fields\n * that already exist.\n */ \nFilament.assign=(target,...mixins)=>{\n\tfor (const mixin of mixins) for (const field in mixin){\n\t\tif(!(field in target)){\n\t\t\ttarget[field] = mixin[field];\n\t\t}\n\t}\n}\n\nFilament.mixin_object=(target,mixin)=>{\n\tFilament.assign(target,mixin);\n\tif(typeof mixin.implement === 'function'){ mixin.implement.call(target); }\n}\n\nFilament.mixin=(target,mixin)=>{\n\tif (!(target instanceof Function)){ return Filament.mixin_object(target,mixin); }\n\tif(!target._mixins){ target._mixins=[] }\n\ttarget._mixins.push(mixin);\n\tFilament.assign(target.prototype,mixin);\n\ttarget.prototype.implement=Filament.implement.bind(this);\n}\nFilament.implement=function(instance,clazz){\n\tif (!instance || !clazz._mixins){ return; }\n\tfor (const mixin of clazz._mixins){\n\t\tif(typeof mixin.implement === 'function'){ mixin.implement.call(instance); }\n\t}\n}\n\nFilament.untag=(s,...v)=>{\n\tif(!(s instanceof Array)){ return s; }\n\tlet string = '';\n\tfor (const i in s){ string+=s[i]+(v[i]||''); }\n\treturn string;\n}\n\nFilament.html=(...args)=>{\n\tconst string = Filament.untag(...args);\n\tconst div = document.createElement('div');\n\tdiv.innerHTML=string;\n\treturn new Filament.NodeList(...div.childNodes);\n}\n\nFilament.NodeList=class extends Array{\n\tmount(target){\n\t\tfor (const node of this){\n\t\t\ttarget.append(node);\n\t\t}\n\t\treturn this;\n\t}\n\telements(){\n\t\tlet array = [];\n\t\tfor (const node of this){\n\t\t\tif(node instanceof Element){ array.push(node); }\n\t\t}\n\t\treturn array;\n\t}\n}\n\nFilament.createElement=(string,child)=>{\n\tlet match = string.match(/^[^\\s.#[\\]]+/);\n\tif(!match){throw `Couldn't find tagname in string ${string}`;}\n\tconst element = document.createElement(match[0]);\n\tmatch=string.match(/#([^\\s.#[\\]]+)/);\n\tif(match){ element.id=match[1]; }\n\tlet reg=/\\.([^\\s.#[\\]]+)/g;\n\twhile(match=reg.exec(string)){\n\t\telement.classList.add(match[1]);\n\t}\n\treg=/\\[([^\\s.#[\\]=]+)=([^\\s.#[\\]=]+)\\]/g;\n\twhile(match=reg.exec(string)){\n\t\telement.setAttribute(match[1],match[2]);\n\t}\n\tif(child){ element.append(child); }\n\telement.mount=Filament.mountElement;\n\treturn element;\n}\n\nFilament.mountElement=function(target){\n\tif(!(this instanceof Element)){ return; }\n\ttarget.append(this);\n\treturn this;\n};\n\n{\n\tconst handler = {construct(){return handler;}};\n\tFilament.isConstructor=f=>{\n\t\ttry{\n\t\t\treturn Boolean(new (new Proxy(f,handler)));\n\t\t}catch(err){\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\nFilament.CoordMap = class{\n\tconstructor(dimensions=2,dfault=null,...defaultArgs){\n\t\tthis.dimensions=dimensions;\n\t\tthis.dfault=dfault;\n\t\tthis.defaultArgs=defaultArgs;\n\t\tthis.data={};\n\t}\n\tget(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn this._getValue(x);\n\t\t}\n\t\treturn this._getSubDimension(x).get(...yz);\n\t}\n\t_getValue(x){\n\t\tif(x in this.data){\n\t\t\treturn this.data[x];\n\t\t}\n\t\tif(typeof this.dfault==='function'){\n\t\t\tif(Filament.isConstructor(this.dfault)){\n\t\t\t\treturn new this.dfault(...this.defaultArgs);\n\t\t\t}else{\n\t\t\t\treturn this.dfault(...this.defaultArgs);\n\t\t\t}\n\t\t}else{\n\t\t\treturn this.dfault;\n\t\t}\n\t}\n\t_getSubDimension(x){\n\t\tif( !(this.data[x] instanceof Filament.CoordMap) ){\n\t\t\tthis.data[x]=new Filament.CoordMap(this.dimensions-1,this.dfault,...this.defaultArgs);\n\t\t}\n\t\treturn this.data[x];\n\t}\n\tset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tthis.data[x]=yz[0];\n\t\t\treturn;\n\t\t}\n\t\tthis._getSubDimension(x).set(...yz);\n\t}\n\tunset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tdelete this.data[x];\n\t\t\treturn;\n\t\t}\n\t\tconst subdimension = this._getSubDimension(x);\n\t\tsubdimension.unset(...yz);\n\t\tif(Object.keys(subdimension.data).length===0){\n\t\t\tdelete this.data[x];\n\t\t}\n\t}\n\thas(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn x in this.data;\n\t\t}\n\t\tif( !(x in this.data) ){ return false;}\n\t\treturn this._getSubDimension(x).has(...yz);\n\t}\n}\n","Filament.pixiCanvas = document.querySelector(\"#screen-game canvas\");\nFilament.parent = Filament.pixiCanvas.parentElement;\nFilament.ui_container = document.getElementById(\"ui-container\");\nFilament.pixi = new PIXI.Application({\n\tview: Filament.pixiCanvas,\n\twidth: Filament.settings.width,\n\theight: Filament.settings.height,\n\tbackgroundColor:0x000088\n});\n\nFilament.start=async function(){\n\tawait Filament.loadSettings();\n\tFilament.pixiContext = Filament.pixiCanvas.getContext(\"2d\");\n\tif( Filament.settings.scaleMode === Filament.SCALE_MODE.HYBRID ){\n\t\tFilament.hybridCanvas = document.createElement('canvas');\n\t\tFilament.hybridContext = Filament.hybridCanvas.getContext(\"2d\");\n\t\tFilament.hybridCanvas.id=\"hybrid-canvas\";\n\t\tFilament.pixiCanvas.parentElement.appendChild(Filament.hybridCanvas);\n\t\tFilament.pixiCanvas.style.opacity=0;\n\t}\n\n\tFilament.ui_container.style.width = Filament.settings.width*Filament.settings.uiRes+\"px\";\n\tFilament.ui_container.style.height = Filament.settings.height*Filament.settings.uiRes+\"px\";\n\n\twindow.addEventListener('resize',Filament.resize);\n\tFilament.resize();\n\tFilament.ticker = Filament.pixi.ticker.add(Filament.update,Filament);\n\n\tfor (const scene of Object.values(Filament.scenes)){\n\t\tscene.start();\n\t}\n};\n\nFilament.update=()=>{\n\tconst delta = Filament.ticker.elapsedMS/1000;\n\n\tif(Filament.scene){\n\t\tFilament.scene.update(delta);\n\t\tFilament.scene.updateUI(delta);\n\t}\n\n\tif(Filament.hybridCanvas){\n\t\tFilament.pixi.render();\n\t\tFilament.hybridContext.drawImage(\n\t\t\tFilament.pixiCanvas,\n\t\t\t0,0, Filament.settings.width, Filament.settings.height,\n\t\t\t0,0, Filament.hybridCanvas.width, Filament.hybridCanvas.height\n\t\t);\n\t}\n};\n\nFilament.roundScale=n=>Math.round(n)||1;\n\nFilament.resize=()=>{\n\tlet scaleX = Filament.parent.offsetWidth / Filament.settings.width;\n\tlet scaleY = Filament.parent.offsetHeight / Filament.settings.height;\n\tlet scale = Math.min(scaleX,scaleY);\n\tif(Filament.settings.maintainAspectRatio){\n\t\tscaleX = scaleY = scale;\n\t}else{\n\t\tlet ratio1 = Filament.parent.offsetWidth/Filament.parent.offsetHeight;\n\t\tlet ratio2 = Filament.settings.width/Filament.settings.height;\n\t\tif(ratio1>ratio2){//wide\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.height*ratio1,\n\t\t\t\tFilament.settings.height\n\t\t\t);\n\t\t}else{ //tall\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.width,\n\t\t\t\tFilament.settings.width/ratio1\n\t\t\t);\n\t\t}\n\t\t\n\t}\n\tFilament.scaleX=scaleX;\n\tFilament.scaleY=scaleY;\n\tFilament.scale=scale;\n\tdocument.body.style.setProperty('--scale',scale);\n\n\tFilament.pixiCanvas.style.width = Filament.settings.width*scaleX+\"px\";\n\tFilament.pixiCanvas.style.height = Filament.settings.height*scaleY+\"px\";\n\tif(Filament.hybridCanvas){\n\t\tFilament.hybridCanvas.width = Filament.settings.width*Filament.roundScale(scaleX);\n\t\tFilament.hybridCanvas.height = Filament.settings.height*Filament.roundScale(scaleY);\n\t\tFilament.hybridCanvas.style.width = Filament.pixiCanvas.style.width;\n\t\tFilament.hybridCanvas.style.height = Filament.pixiCanvas.style.height;\n\t\tFilament.hybridContext.imageSmoothingEnabled=false;\n\t}\n\tFilament.ui_container.style.setProperty('--scale',\n\t\tscale/Filament.settings.uiRes);\n\tFilament.ui_container.style.setProperty('--left',\n\t\tFilament.parent.offsetWidth/2 - Filament.ui_container.offsetWidth/2);\n\tFilament.ui_container.style.setProperty('--top',\n\t\tFilament.parent.offsetHeight/2 - Filament.ui_container.offsetHeight/2);\n};","Filament.MixinEvents={\n\timplement(){\n\t\tthis.events={};\n\t},\n\tgetEventList(eventname,create){\n\t\tif(!(eventname in this.events) && create){\n\t\t\tthis.events[eventname]=[];\n\t\t}\n\t\treturn this.events[eventname];\n\t},\n\tfireEvent(eventname,event={}){\n\t\tconst eventlist=this.getEventList(eventname,false);\n\t\tif(!eventlist){ return; }\n\t\tfor (const callback of eventlist){\n\t\t\tevent.remove=Filament.MixinEvents.removeEvent.bind(this,eventname,callback);\n\t\t\tif(typeof callback === 'function'){ callback(event); }\n\t\t}\n\t\t\n\t},\n\taddEvent(eventname,callback){\n\t\treturn Filament.arrayAdd(this.getEventList(eventname,true),callback);\n\t},\n\tremoveEvent(eventname,callback){\n\t\tconst eventlist = this.getEventList(eventname,false);\n\t\tif(!eventlist){ return false; }\n\t\treturn Filament.arrayRemove(this.events[eventname],callback);\n\t}\n}\n\nFilament.MixinEventHandler={\n\teventHandler(eventname,event){\n\t\tif(typeof this.fireEvent==='function'){\n\t\t\tthis.fireEvent(eventname,event);\n\t\t}\n\t},\n\taddEventHandler(eventname,addListener=true){\n\t\tconst handler = `${eventname}Handler`;\n\t\tthis[handler]=this.eventHandler.bind(this,eventname);\n\t\tif(addListener){\n\t\t\tFilament.parent.addEventListener(eventname,this[handler]);\n\t\t}\n\t},\n}","Filament.MixinUtil={\r\n\tmount(parent){\r\n\t\tparent.addChild(this);\r\n\t\treturn this;\r\n    },\r\n    assign(key,value){\r\n        if(typeof arguments[0]===\"object\"){\r\n            Object.assign(this,arguments[0]);\r\n        }else{\r\n            this[key]=value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\nFilament.mixin(PIXI.DisplayObject, Filament.MixinUtil);","Filament.Cache=class{\n\tconstructor(){\n\t\tthis._cache={};\n\t}\n\n\tasync requestImage(key,path='assets/images'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\tresource.texture.baseTexture.scaleMode=Filament.pixiScaleMode;\n\t\t\treturn resource.texture;\n\t\t});\n\t}\n\tasync requestAudio(key){\n\t\t\n\t}\n\tasync requestJSON(key,path='data'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\treturn resource.data;\n\t\t})\n\t}\n\tasync requestTileset(id){\n\t\tconst data = await this.requestJSON(`tilesets/${id}.json`);\n\t\tconst image = await this.requestImage(data.image,'assets/tilesets');\n\t\treturn new Filament.TileSet(image,data);\n\t}\n\tasync gameAsset(key,path,callback){\n\t\tpath=Filament.path(path,key);\n\t\treturn await this.requestAsset(path,Filament.gameFile(path),callback);\n\t}\n\trequestAsset(key,url,callback){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tif(!this._cache[key]){\n\t\t\t\tthis._cache[key]=new Filament.AssetLoader(key,url,this);\n\t\t\t}\n\t\t\tif(this._cache[key] instanceof Filament.AssetLoader){\n\t\t\t\tthis._cache[key].addRequest(resolve,reject,callback);\n\t\t\t}else{\n\t\t\t\tresolve(callback(this._cache[key]));\n\t\t\t}\n\t\t});\n\t}\n}\nFilament.cache=new Filament.Cache();\n\nFilament.AssetLoader=class extends PIXI.loaders.Loader{\n\tconstructor(key,url,cache){\n\t\tsuper();\n\t\tthis.add(key,url);\n\t\tthis._requests=[];\n\t\tthis.load((loader,resources)=>{\n\t\t\tconst resource=resources[key];\n\t\t\tfor (const request of this._requests){\n\t\t\t\tif(resource.error){\n\t\t\t\t\trequest.reject(resource.error);\n\t\t\t\t}else{\n\t\t\t\t\trequest.resolve(request.callback(resource));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(resource.error){\n\t\t\t\tdelete cache._cache[key];\n\t\t\t}else{\n\t\t\t\tcache._cache[key]=resource;\n\t\t\t}\n\t\t});\n\t}\n\taddRequest(resolve,reject,callback){\n\t\tthis._requests.push(new Filament.AssetRequest(resolve,reject,callback));\n\t}\n}\n\nFilament.AssetRequest=class{\n\tconstructor(resolve,reject,callback){\n\t\tthis.resolve=resolve;\n\t\tthis.reject=reject;\n\t\tthis.callback=callback;\n\t}\n}","Filament.UI = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.ui = document.createElement('div');\n\t\tthis.anchor = new PIXI.ObservablePoint(this._onAnchorUpdate, this);\n\t\tthis.setAccessor('id');\n\t\tthis.setAccessor('className');\n\t\tthis.classList=this.ui.classList;\n\t\tthis.style=this.ui.style;\n\t\tthis.style.position=\"absolute\";\n\t}\n\tmount(parent){\n\t\tparent.addChild(this);\n\t\treturn this;\n\t}\n\tmountUI(parent){\n\t\t(parent instanceof Filament.UI ? parent.ui : parent).append(this.ui);\n\t\treturn this;\n\t}\n\tsetAccessor(v1,v2=v1){\n\t\tObject.defineProperty(this,v1,{\n\t\t\tget(){return this.ui[v2];},\n\t\t\tset(v){this.ui[v2]=v;}\n\t\t});\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-enabled',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-enabled',false);\n\t}\n\tdestroy(){\n\t\tsuper.destroy();\n\t\tthis.ui.parentNode.removeChild(this.ui);\n\t}\n\tsetAttribute(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.getAttribute(name)!==value){\n\t\t\tthis.ui.setAttribute(name,value);\n\t\t}\n\t}\n\tsetProperty(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.style.getPropertyValue(name)!==value){\n\t\t\tthis.ui.style.setProperty(name,value);\n\t\t}\n\t}\n\tsetAttributes(attributes){\n\t\tfor (const key in attributes){ this.setAttribute(key,attributes[key]); }\n\t}\n\tsetProperties(properties){\n\t\tfor (const key in properties){ this.setProperty(key,properties[key]); }\n\t}\n\tupdateUI(delta){\n\t\tthis.setAttribute(\"data-visible\",this.worldVisible);\n\t\tif(!this.ui.parentNode && this.scene && this.scene!==this){ this.mountUI(this.scene); }\n\t}\n\t_onAnchorUpdate(){\n\t\t//this.ui.style.transform = \"translate(\"+-this.anchor.x*100+\"%,\"+-this.anchor.y*100+\"%)\";\n\t}\n}","/* NOTES\nLethality (attack power)\nResilience (hp and def)\nHaste (SP)\nSpirit (MP)\n\nhidden stats:\nLuck\n\n\nEquipment types:\nWeapon\nArmor\nAccessory\n*/\n\nFilament.Battler = class{\n\tconstructor(){\n\t\tthis.stats={\n\t\t\tlethality:0,\n\t\t\tresilience:0,\n\t\t\thaste:0,\n\t\t\tspirit:0,\n\t\t\tluck:0,\n\t\t};\n\t}\n};","Filament.Sprite = class extends PIXI.Sprite{\n\tconstructor(key){\n\t\tsuper(PIXI.Texture.EMPTY);\n\t\tthis.loadTexture(key);\n\t}\n\tasync loadTexture(key){\n\t\tthis.texture=await Filament.cache.requestImage(key);\n\t}\n}","Filament.scenes={};\nFilament.activeScene=\"home\";\nObject.defineProperty(Filament,\"scene\",{\n\tget:()=>Filament.scenes[Filament.activeScene]||Filament.scenes.home,\n\tset(value){\n\t\tconst oldScene=Filament.activeScene;\n\t\tif(value in Filament.scenes){\n\t\t\tFilament.activeScene=value;\n\t\t}else{\n\t\t\tfor (const key in Filament.scenes){\n\t\t\t\tif(value===Filament.scenes[key]){\n\t\t\t\t\tFilament.activeScene=key;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(Filament.activeScene===oldScene){ return; }\n\t\tfor (const key in Filament.scenes){\n\t\t\tconst scene = Filament.scenes[key];\n\t\t\tif(Filament.activeScene===scene.name){\n\t\t\t\tscene.enable();\n\t\t\t\tscene.enter();\n\t\t\t}else if (scene.enabled){\n\t\t\t\tscene.disable();\n\t\t\t\tscene.leave();\n\t\t\t}\n\t\t}\n\t}\n})\n\nFilament.ui_container = document.getElementById(\"ui-container\");\n\nFilament.Scene = class extends Filament.UI{\n\tconstructor(name){\n\t\tsuper();\n\t\tthis.mountUI(Filament.ui_container);\n\t\tthis.mount(Filament.pixi.stage);\n\t\tFilament.scenes[name] = this;\n\t\tthis.id=\"scene-\"+name;\n\t\tthis.classList.add(\"scene\");\n\t\tthis.name=name;\n\t\tthis.windows=[];\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-visible',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tfor (let i=this.windows.length-1; i>=0; --i){\n\t\t\tthis.windows[i].updateUI(delta);\n\t\t}\n\t}\n\tstart(){}\n\tenter(){}\n\tleave(){}\n}","Filament.Window = class extends Filament.UI{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('window');\n\t\tthis.ui_width=20;\n\t\tthis.ui_height=20;\n\t\tthis.minwidth=20;\n\t\tthis.minheight=20;\n\t\tthis.maxwidth=Filament.settings.width;\n\t\tthis.maxheight=Filament.settings.height;\n\t\tthis._hasFrame=false;\n\t\tthis._interactive=false;\n\t\tthis.movable=false;\n\t\tthis.resizable=false;\n\t\tthis.closable=false;\n\t\tthis.edgeSnap=true;\n\t\tthis.content=Filament.createElement('div.content').mount(this.ui);\n\t\tthis.handle=Filament.createElement('div.handle').mount(this.ui);\n\t\tthis.closeButton=Filament.createElement('div.closeButton','Ã—').mount(this.ui);\n\t\tthis.closeButton.addEventListener('click',event=>{\n\t\t\tthis.destroy();\n\t\t});\n\t\tthis.teletype=0;\n\t\tthis.handle.addEventListener('mousedown',event=>{\n\t\t\tFilament.arrayRemove(this.scene.windows,this);\n\t\t\tFilament.arrayAdd(this.scene.windows,this);\n\t\t\tthis.dragging=true;\n\t\t});\n\t\tthis.handle.addEventListener('mouseup',event=>{\n\t\t\tthis.dragging=false;\n\t\t\tthis.finishDrag(event);\n\t\t});\n\t\tthis.contentObserver=new MutationObserver(()=>{\n\t\t\tif(this.resizable){\n\t\t\t\tif(this.content.style.width||this.content.style.height){\n\t\t\t\t\tthis.content.style.width='';\n\t\t\t\t\tthis.content.style.height='';\n\t\t\t\t\tthis.resizing=true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.contentObserver.observe(this.content,{attributes:true,attributeFilter:['style']});\n\t}\n\tmount(parent){\n\t\tsuper.mount(parent);\n\t\tif(parent.scene)this.mountUI(this.scene);\n\t\treturn this;\n\t}\n\tmountUI(scene){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.mountUI(scene);\n\t\tFilament.arrayAdd(scene.windows,this);\n\t\treturn this;\n\t}\n\tdestroy(){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.destroy(...arguments);\n\t}\n\tget width(){return this.ui_width;}\n\tset width(v){this.ui_width=v;}\n\tget height(){return this.ui_height;}\n\tset height(v){this.ui_height=v;}\n\tget interactive(){return this._interactive||this.movable||this.resizable||this.closable;}\n\tset interactive(v){this._interactive=v;}\n\tget hasFrame(){return this._hasFrame||this.movable||this.resizable||this.closable;}\n\tset hasFrame(v){this._hasFrame=v;}\n\tgetBoundsUI(){\n\t\tlet bounds = {};\n\t\tbounds.width = Filament.round(this.width,2);\n\t\tbounds.height = Filament.round(this.height,2);\n\t\tbounds.left=Filament.round(this.worldTransform.tx-this.anchor.x*bounds.width,2);\n\t\tbounds.top=Filament.round(this.worldTransform.ty-this.anchor.y*bounds.height,2);\n\t\tif(this.edgeSnap){\n\t\t\tbounds.left=Filament.minmax(0,Filament.settings.width-bounds.width,bounds.left);\n\t\t\tbounds.top=Filament.minmax(0,Filament.settings.height-bounds.height,bounds.top);\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tif(this.resizable){\n\t\t\tthis.width=Filament.minmax(this.minwidth,this.maxwidth,this.width);\n\t\t\tthis.height=Filament.minmax(this.minheight,this.maxheight,this.height);\n\t\t}\n\t\tlet bounds = this.getBoundsUI(true);\n\t\tconst windex = this.scene.windows.indexOf(this);\n\t\tthis.setProperties({\n\t\t\t\"--width\"\t:\tbounds.width,\n\t\t\t\"--height\"\t:\tbounds.height,\n\t\t\t\"--x\"\t\t:\tbounds.left,\n\t\t\t\"--y\"\t\t:\tbounds.top,\n\t\t\t\"--z\"\t\t:\tthis.zIndex+windex/1000,\n\t\t\t\"--alpha\"\t:\tthis.worldAlpha,\n\t\t});\n\t\tthis.setAttributes({\n\t\t\t\"data-frame\"\t\t:\tthis.hasFrame,\n\t\t\t\"data-interactive\"\t:\tthis.interactive,\n\t\t\t\"data-movable\"\t\t:\tthis.movable,\n\t\t\t\"data-resizable\"\t:\tthis.resizable,\n\t\t\t\"data-closable\"\t\t:\tthis.closable,\n\t\t});\n\t}\n\tupdateDrag(event){\n\t\tthis.x+=event.movementX/Filament.scale;\n\t\tthis.y+=event.movementY/Filament.scale;\n\t}\n\tfinishDrag(event){\n\t\tif(this.edgeSnap){\n\t\t\tthis.x=Filament.minmax(0,Filament.settings.width-this.width,this.x);\n\t\t\tthis.y=Filament.minmax(0,Filament.settings.height-this.height,this.y);\n\t\t}\n\t}\n\tupdateResize(event){\n\t\tthis.width=Math.min(Filament.settings.width-this.x, this.width+event.movementX/Filament.scale);\n\t\tthis.height=Math.min(Filament.settings.height-this.y, this.height+event.movementY/Filament.scale);\n\t\tthis.resizing=false;\n\t}\n\n\tget text(){ return this.content.innerHTML; }\n\tset text(value){\n\n\t}\n}\n\nwindow.addEventListener('mousemove',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\tif (win.dragging){ win.updateDrag(event); }\n\t\tif (win.resizing){ win.updateResize(event); }\n\t}\n});\nwindow.addEventListener('mouseup',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\twin.dragging=false;\n\t\twin.finishDrag();\n\t}\n});","Filament.keyboard={\n\tkeys:{},\n\teventHandler(eventname,event){\n\t\tconst key = this.getKey(event.code,false);\n\t\tif(!key){ return; }\n\t\tif(typeof key[eventname] === 'function')key[eventname]();\n\t\tfor (const keygroup of key.keygroups){\n\t\t\tkeygroup.fireEvent(eventname,event);\n\t\t}\n\t},\n\tgetKey(keyname,create){\n\t\tif(!(keyname in this.keys) && create){\n\t\t\tthis.keys[keyname]=new Filament.Key(keyname);\n\t\t}\n\t\treturn this.keys[keyname];\n\t}\n};\nFilament.mixin_object(Filament.keyboard,Filament.MixinEventHandler);\nFilament.keyboard.addEventHandler('keydown');\nFilament.keyboard.addEventHandler('keyup');\n\nFilament.Key = class{\n\tconstructor(name){\n\t\tthis.name=name;\n\t\tthis.isDown=false;\n\t\tthis.keygroups=[];\n\t}\n\tkeydown(){\n\t\tthis.isDown=true;\n\t}\n\tkeyup(){\n\t\tthis.isDown=false;\n\t}\n}\n\nFilament.keys={};\nFilament.KeyGroup = class{\n\tconstructor(name,keynames=[]){\n\t\tthis.name=name;\n\t\tFilament.keys[name]=this;\n\t\tthis.keys=[];\n\t\tfor (const keyname of keynames){\n\t\t\tthis.addKey(keyname);\n\t\t}\n\t\t//Filament.mixin(this,Filament.EventMixin);\n\t\tthis.implement(this,Filament.KeyGroup);\n\t}\n\taddKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,true);\n\t\tFilament.arrayAdd(key.keygroups,this);\n\t\tFilament.arrayAdd(this.keys,key);\n\t}\n\tremoveKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,false);\n\t\tif(!key){ return; }\n\t\tFilament.arrayRemove(key.keygroups,this);\n\t\tFilament.arrayRemove(this.keys,key);\n\t}\n\tget isDown(){\n\t\tfor (const key in this.keys){\n\t\t\tif(key.isDown){ return true; }\n\t\t}\n\t\treturn false;\n\t}\n}\nFilament.mixin(Filament.KeyGroup, Filament.MixinEvents);\n\nnew Filament.KeyGroup('CONFIRM',['Enter','Space']);\nnew Filament.KeyGroup('CANCEL',['Escape']);\nnew Filament.KeyGroup('UP',['ArrowUp','KeyW']);\nnew Filament.KeyGroup('LEFT',['ArrowLeft','KeyA']);\nnew Filament.KeyGroup('DOWN',['ArrowDown','KeyS']);\nnew Filament.KeyGroup('RIGHT',['ArrowRight','KeyD']);","Filament.mouse={\r\n    eventHandler(eventname,event){\r\n        const canvasBounds = Filament.pixiCanvas.getBoundingClientRect();\r\n        event.canvasX=(event.clientX-canvasBounds.x)/Filament.scaleX;\r\n        event.canvasY=(event.clientY-canvasBounds.y)/Filament.scaleY;\r\n\t\tthis.fireEvent(eventname,event);\r\n\t},\r\n}\r\nFilament.mixin_object(Filament.mouse,Filament.MixinEvents);\r\nFilament.mixin_object(Filament.mouse,Filament.MixinEventHandler);\r\n\r\nFilament.mouse.addEventHandler('click');\r\nFilament.mouse.addEventHandler('dblclick');\r\nFilament.mouse.addEventHandler('mousedown');\r\nFilament.mouse.addEventHandler('mouseup');\r\nFilament.mouse.addEventHandler('mousemove');","new Filament.Scene('home');\n\nFilament.scenes.home.start=function(){\n\tthis.window = new Filament.Window().mount(this);\n\tthis.window.width=100;\n\tthis.window.height=50;\n\tthis.window.x=50;\n\tthis.window.y=75;\n\tthis.window.resizable=true;\n\tthis.window.movable=true;\n\tthis.window.closable=true;\n\tthis.window.content.innerHTML=`Welcome to Filament!<br>\n\t<a href=\"javascript:void(Filament.scene='map');\">Map</a>`;\n\tnew Filament.Sprite('ebby.png').mount(this).assign({alpha:0.6});\n\tnew Filament.Sprite('ebby.png').mount(this).assign({x:20});\n}\n\nFilament.scenes.home.update=function(){\n\t\n}","new Filament.Scene('map');\n\nFilament.scenes.map.start=function(){\n\tFilament.map = new Filament.TileMap().mount(this);\n}\n\nFilament.scenes.map.update=function(){\n\t\n}","\nFilament.MapCellTexture = class extends PIXI.RenderTexture{\n\tconstructor(tilemap){\n\t\tsuper(new PIXI.BaseRenderTexture({\n\t\t\twidth: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\theight: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\tscaleMode: Filament.pixiScaleMode,\n\t\t}));\n\t\tthis.tilemap=tilemap;\n\t}\n};\n\nFilament.MapCellLayer = class extends PIXI.Sprite{\n\tconstructor(tilemap){\n\t\tsuper(new Filament.MapCellTexture(tilemap));\n\t}\n\tdestroy(){\n\t\tsuper.destroy(...arguments);\n\t\tthis.texture.destroy();\n\t}\n\tdrawTile(tileset,tx,ty,x,y){\n\t\tconst stamp = tileset.getStamp(tx,ty);\n\t\tstamp.position.set(x,y);\n\t\tFilament.pixi.renderer.render(stamp,this.texture);\n\t}\n}\n\n/**\n * An object representing an indivitual cell in the tilemap.\n * contains a reference to MapCellLayer objects for the base and fringe layers as well as\n * a list of all entities in the actorLayer associated with this cell.\n */\nFilament.MapCell = class{\n\tconstructor(tilemap){\n\t\tthis.tilemap=tilemap;\n\t\tthis.baseLayer=new Filament.MapCellLayer();\n\t\tthis.fringeLayer=new Filament.MapCellLayer();\n\t\ttilemap.baseLayer.addChild(this.baseLayer);\n\t\ttilemap.fringeLayer.addChild(this.fringeLayer);\n\t\tthis.loaded=false;\n\t\tthis.lastTileset=0;\n\t\tthis.texture = new MapCellTexture(this.tilemap);\n\t}\n\tasync load(){\n\t\t// load cell terrain and json\n\t\tthis.data=[];\n\t\tthis.actors=[];\n\n\t\t// loop through each tile stack in the data\n\t\tfor(let i=0;i<data.length;++i){\n\t\t\tconst stack = data[i];\n\t\t\tconst x=i%this.tilemap.cellSize;\n\t\t\tconst y=Math.floor(i/Math.tilemap.cellSize);\n\t\t\tif(stack instanceof Array){\n\t\t\t\tfor(const tile of stack){ await this.loadTile(tile,x,y); }\n\t\t\t}else{\n\t\t\t\tawait this.loadTile(stack,x,y);\n\t\t\t}\n\t\t}\n\t\tthis.loaded=true;\n\t}\n\tasync loadTile(tileData,x,y){\n\t\tconst tilesetId='ts' in tileData ? tileData.ts : this.lastTileset;\n\t\tif(tilesetId !== this.lastTileset){ this.lastTileset = tilesetId; }\n\t\tconst tileX=tileData.x;\n\t\tconst tileY=tileData.y;\n\t\tconst tileset=Filament.cache.requestTileset(tilesetId);\n\t\t// get tile layer data so we know how to draw it.\n\t\tconst layerType = tileset.getTile(tileX,tileY).layer;\n\t\tswitch(layerType){\n\t\tcase 0://base\n\t\t\tthis.baseLayer.drawTile(tileset,tileX,tileY,x,y);\n\t\t\tbreak;\n\t\tcase 1://actor\n\t\t\tbreak;\n\t\tcase 2://fringe\n\t\t\tbreak;\n\t\tcase 3://overpass\n\t\t\tbreak;\n\t\tdefault:\n\t\t}\n\t}\n\tunload(){\n\t\tthis.baseLayer.destroy();\n\t\tthis.fringeLayer.destroy();\n\t}\n}\n\nFilament.TileSet = class{\n\tconstructor(image,data){\n\t\tthis.image=image;\n\t\tthis.data=data;\n\t\tthis.stamp = new PIXI.Sprite(image);\n\t}\n\tgetStamp(x,y){\n\t\tconst ts=this.data.tileSize;\n\t\tthis.stamp.crop(x*ts,y*ts,ts,ts);\n\t\treturn this.stamp;\n\t}\n\tgetTile(x,y){\n\t\tconst row = this.data.data[y];\n\t\tif(!row){ return null; }\n\t\tlet tile = row[x];\n\t\tif(tile==undefined){ return null; }\n\t\tif( typeof tile==='number' ){\n\t\t\ttile={data:tile,note:''};\n\t\t}else if( tile.passage ){ return tile; }\n\t\ttile.passage = tile.data & 0b1111;\n\t\ttile.opaque = (tile.data>>>4) & 0b1;\n\t\ttile.layer = (tile.data>>>5) & 0b111;\n\t\ttile.terrain = tile.data>>>8;\n\t\trow[x]=tile;\n\t}\n}\n\n/**\n * The TileMap Class.\n * Each tilemap has multiple elevation layers.\n */\nFilament.TileMap = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.baseLayer = new PIXI.Container();\n\t\tthis.actorLayer = new PIXI.Container();\n\t\tthis.fringeLayer = new PIXI.Container();\n\t\tthis.cells = new Filament.CoordMap(2);\n\t\t// TODO: read map settings from JSON.\n\t\tthis.selector = new Filament.TileSelector().mount(this);\n\t\tthis.settings={\n\t\t\tname:'',\n\t\t\tcellSize:null,\n\t\t};\n\t}\n\tget cellSize(){\n\t\treturn this.settings.cellSize?this.settings.cellSize:Filament.settings.cellSize;\n\t}\n\tmount(){\n\t\tsuper.mount(...arguments);\n\t\tthis.selector.mountUI(this.scene);\n\t}\n}\n\n/*\nBetter idea for elevation.\nEverything is handled in one layer with tile stacks as usual.\n\nAn tile can be opaque or transparent.\nOpaque tiles erase underlying tiles when placed.\nTransparent tiles stack on top of underlying tiles.\n\nThere are four \"layering\" options for each tile.\nBase is rendered under player.\nActor is rendered same layer as player.\nFringe is rendered above player.\nOverpass is special. It's in the actor layer, but is rendered above or below the player depending on their elevation.\noverpass elevation is one plus the number of overpass tiles underlying in the stack.\nWhen player can step onto overpass tile, their elevation is set to same as the overpass they're walking on.\nWhen player can't step onto the overpass tile, they instead step under it.\n\n*/\n\nFilament.TileSelector = class extends Filament.Window{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('tileSelector');\n\t\tthis.minwidth=0;\n\t\tthis.minheight=0;\n\t\tthis.width=Filament.settings.tileSize;\n\t\tthis.height=Filament.settings.tileSize;\n\t\tthis.edgeSnap=true;\n\t\tFilament.mouse.addEvent('mousemove',this.mouseMove.bind(this));\n\t}\n\n\tmouseMove(event){\n\t\tif(!this.scene){\n\t\t\tevent.remove();\n\t\t}\n\t\tthis.x=Filament.floorFactor(event.canvasX,Filament.settings.tileSize);\n\t\tthis.y=Filament.floorFactor(event.canvasY,Filament.settings.tileSize);\n\t}\n}"]}